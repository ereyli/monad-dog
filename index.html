<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monad Dog</title>
  
  <!-- Farcaster Meta -->
  <meta name="fc:frame" content='{
    "version": "next",
    "imageUrl": "https://monad-dog.vercel.app/icon.png",
    "button": {
      "title": "Launch App",
      "action": {
        "type": "launch_frame",
        "url": "https://monad-dog.vercel.app"
      }
    }
  }' />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      color: white;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .xp {
      background: rgba(255,255,255,0.1);
      padding: 10px 20px;
      border-radius: 20px;
      display: inline-block;
      margin-bottom: 20px;
    }
    
    .wallet-section {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
    }
    
    button:hover {
      background: #5855e8;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .tabs {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    
    .tab.active {
      background: #6366f1;
    }
    
    .content {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      min-height: 200px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .dog-image {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      margin: 20px auto;
      display: block;
    }
    
    .coin {
      font-size: 60px;
      margin: 20px;
      transition: transform 0.5s;
    }
    
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      display: none;
    }
    
    .status.visible {
      display: block;
    }
    
    .status.success {
      background: rgba(0,255,0,0.2);
      color: #00ff00;
    }
    
    .status.error {
      background: rgba(255,0,0,0.2);
      color: #ff6b6b;
    }
    
    .status.pending {
      background: rgba(255,255,0,0.2);
      color: #ffeb3b;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    th {
      background: rgba(255,255,255,0.1);
    }
    
    .address {
      font-family: monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">üêï Monad Dog</div>
      <div class="xp">‚ú® XP: <span id="xp">0</span></div>
    </div>

    <div class="wallet-section">
      <div id="connect-area">
        <button id="connect-btn">üü£ Connect Wallet</button>
      </div>
      <div id="connected-area" style="display: none;">
        <div>üü£ Connected</div>
        <div id="address" class="address"></div>
        <button id="disconnect-btn">Disconnect</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('pet')">üêï Pet</button>
      <button class="tab" onclick="showTab('greet')">üëã Greet</button>
      <button class="tab" onclick="showTab('flip')">ü™ô Flip</button>
      <button class="tab" onclick="showTab('leaderboard')">üèÜ Ranks</button>
    </div>

    <div class="content">
      <!-- Pet Tab -->
      <div id="pet" class="tab-content active">
        <h3>Pet the Dog</h3>
        <img id="dog-img" class="dog-image" src="https://placedog.net/400/300?id=7" alt="Dog">
        <button onclick="petDog()">üëã Pet Dog (+10 XP)</button>
        <div id="pet-status" class="status"></div>
      </div>

      <!-- Greet Tab -->
      <div id="greet" class="tab-content">
        <h3>Greet Community</h3>
        <p>Say GM or GN to the community!</p>
        <button onclick="sayGM()">‚òÄÔ∏è Good Morning (+5 XP)</button>
        <button onclick="sayGN()">üåô Good Night (+5 XP)</button>
        <div id="greet-status" class="status"></div>
      </div>

      <!-- Flip Tab -->
      <div id="flip" class="tab-content">
        <h3>Flip Coin</h3>
        <div class="coin" id="coin">ü™ô</div>
        <button onclick="flipCoin()">üé≤ Flip Coin (+3 XP)</button>
        <div id="flip-result">Result will appear here</div>
        <div id="flip-status" class="status"></div>
      </div>

      <!-- Leaderboard Tab -->
      <div id="leaderboard" class="tab-content">
        <h3>Leaderboard</h3>
        <table>
          <tr><th>Rank</th><th>Address</th><th>TX</th></tr>
          <tr><td>#1</td><td class="address">0x742e...26da</td><td>278</td></tr>
          <tr><td>#2</td><td class="address">0x934a...21c</td><td>203</td></tr>
          <tr><td>#3</td><td class="address">0x1fa3...57a</td><td>186</td></tr>
        </table>
      </div>
    </div>

    <div id="loading" class="loading">Loading...</div>
  </div>

  <script>
    console.log('üöÄ Starting app...');
    
    // Global state
    let appState = {
      connected: false,
      address: null,
      xp: 0,
      provider: null,
      signer: null
    };

    // Show loading initially
    document.getElementById('loading').style.display = 'block';

    // Initialize SDK
    let sdk = null;
    
    async function initApp() {
      try {
        console.log('Initializing...');
        
        // Try to import SDK
        try {
          const module = await import('https://esm.sh/@farcaster/frame-sdk');
          sdk = module.sdk;
          console.log('SDK loaded:', !!sdk);
          
          if (sdk) {
            await sdk.actions.ready();
            console.log('SDK ready');
          }
        } catch (e) {
          console.log('SDK not available:', e.message);
        }

        // Setup UI
        setupEventListeners();
        hideLoading();
        
        console.log('‚úÖ App initialized');
        
      } catch (error) {
        console.error('‚ùå Init error:', error);
        hideLoading();
        showError('Failed to initialize app');
      }
    }

    function setupEventListeners() {
      document.getElementById('connect-btn').onclick = connectWallet;
      document.getElementById('disconnect-btn').onclick = disconnect;
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    async function connectWallet() {
      try {
        console.log('Connecting wallet...');
        
        let provider;
        
        if (sdk && sdk.wallet && sdk.wallet.ethProvider) {
          // Use Farcaster wallet
          console.log('Using Farcaster wallet');
          provider = sdk.wallet.ethProvider;
        } else if (window.ethereum) {
          // Fallback to browser wallet
          console.log('Using browser wallet');
          provider = window.ethereum;
        } else {
          throw new Error('No wallet available');
        }

        // Request accounts
        const accounts = await provider.request({
          method: 'eth_requestAccounts'
        });

        if (!accounts || accounts.length === 0) {
          throw new Error('No accounts found');
        }

        console.log('Connected:', accounts[0]);

        // Setup ethers
        appState.provider = new ethers.providers.Web3Provider(provider);
        appState.signer = appState.provider.getSigner();
        appState.address = accounts[0];
        appState.connected = true;

        updateUI();

      } catch (error) {
        console.error('Connection error:', error);
        showError(error.message);
      }
    }

    function disconnect() {
      appState = {
        connected: false,
        address: null,
        xp: appState.xp,
        provider: null,
        signer: null
      };
      updateUI();
    }

    function updateUI() {
      const connectArea = document.getElementById('connect-area');
      const connectedArea = document.getElementById('connected-area');
      const addressEl = document.getElementById('address');

      if (appState.connected) {
        connectArea.style.display = 'none';
        connectedArea.style.display = 'block';
        addressEl.textContent = appState.address.slice(0,6) + '...' + appState.address.slice(-4);
      } else {
        connectArea.style.display = 'block';
        connectedArea.style.display = 'none';
      }
    }

    function addXP(amount) {
      appState.xp += amount;
      document.getElementById('xp').textContent = appState.xp;
    }

    function showStatus(id, message, type) {
      const el = document.getElementById(id);
      el.textContent = message;
      el.className = `status visible ${type}`;
    }

    function hideStatus(id) {
      document.getElementById(id).className = 'status';
    }

    function showError(message) {
      const div = document.createElement('div');
      div.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(255,0,0,0.9);color:white;padding:10px 20px;border-radius:8px;z-index:1000;';
      div.textContent = message;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 5000);
    }

    // Game functions
    function petDog() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      document.getElementById('dog-img').src = `https://placedog.net/400/300?id=${Math.floor(Math.random() * 50) + 1}`;
      
      showStatus('pet-status', 'Petting dog...', 'pending');
      
      setTimeout(() => {
        showStatus('pet-status', 'Dog petted! +10 XP', 'success');
        addXP(10);
        setTimeout(() => hideStatus('pet-status'), 3000);
      }, 2000);
    }

    function sayGM() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      showStatus('greet-status', 'Sending GM...', 'pending');
      
      setTimeout(() => {
        showStatus('greet-status', 'GM sent! +5 XP', 'success');
        addXP(5);
        setTimeout(() => hideStatus('greet-status'), 3000);
      }, 2000);
    }

    function sayGN() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      showStatus('greet-status', 'Sending GN...', 'pending');
      
      setTimeout(() => {
        showStatus('greet-status', 'GN sent! +5 XP', 'success');
        addXP(5);
        setTimeout(() => hideStatus('greet-status'), 3000);
      }, 2000);
    }

    function flipCoin() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      const coin = document.getElementById('coin');
      const result = document.getElementById('flip-result');
      
      showStatus('flip-status', 'Flipping...', 'pending');
      result.textContent = 'Flipping...';
      
      let rotation = 0;
      const interval = setInterval(() => {
        rotation += 180;
        coin.style.transform = `rotateY(${rotation}deg)`;
      }, 100);
      
      setTimeout(() => {
        clearInterval(interval);
        const finalResult = Math.random() < 0.5 ? 'Heads' : 'Tails';
        coin.style.transform = `rotateY(${finalResult === 'Heads' ? 0 : 180}deg)`;
        result.textContent = `Result: ${finalResult}!`;
        showStatus('flip-status', 'Coin flipped! +3 XP', 'success');
        addXP(3);
        setTimeout(() => hideStatus('flip-status'), 3000);
      }, 3000);
    }

    function showTab(tabName) {
      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');
    }

    // Start app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }

    console.log('üì± App script loaded');
  </script>
</body>
</html>
