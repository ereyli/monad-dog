<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Monad Fun Page</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js">
    async function updatePetLeaderboard() {
      const list = document.getElementById('pet-leaderboard');
      if (!list || !provider || !userAddress) return;
      list.innerHTML = '';
      const addresses = [userAddress];
      const contract = new ethers.Contract("0xc53abe4c593b9440407f8ac1b346f3f999e6d8ed", ["function getMyPets(address) public view returns (uint256)"], provider);
      for (let addr of addresses) {
        try {
          const count = await contract.getMyPets(addr);
          const li = document.createElement('li');
          li.textContent = `${addr.slice(0,6)}...${addr.slice(-4)} — ${count.toString()} pets`;
          list.appendChild(li);
        } catch (err) {
          console.error("Error loading pets for", addr, err);
        }
      }
        } catch (err) {
          console.error("Error loading pets for", addr, err);
        }
      }
    }

    async function updateGmGnLeaderboard() {
      const list = document.getElementById('gmgn-leaderboard');
      if (!list || !provider || !userAddress) return;
      list.innerHTML = '';
      const contract = new ethers.Contract("0xbc8b78f3e2348d4b5e0390fe700ce54b59931da4", [
        "function getGmCount(address) public view returns (uint256)",
        "function getGnCount(address) public view returns (uint256)"
      ], provider);
      try {
        const gm = await contract.getGmCount(userAddress);
        const gn = await contract.getGnCount(userAddress);
        const li = document.createElement('li');
        li.textContent = `${userAddress.slice(0,6)}...${userAddress.slice(-4)} — ${gm} GM / ${gn} GN`;
        list.appendChild(li);
      } catch (err) {
        console.error("Error loading gm/gn for", userAddress, err);
      }
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      background: #1e003e;
      color: #ffffff;
      margin: 0;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #2c0069;
    }
    .tab {
      padding: 14px 24px;
      cursor: pointer;
      font-weight: bold;
      background: #2c0069;
      border-bottom: 4px solid transparent;
    }
    .tab.active {
      border-bottom: 4px solid #a259ff;
    }
    .tab-content {
      display: none;
      padding: 20px;
      text-align: center;
    }
    .tab-content.active {
      display: block;
    }
    button {
      font-size: 20px;
      padding: 12px 24px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
      background-color: #a259ff;
      color: white;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover {
      background-color: #c084ff;
    }
    .info {
      margin-top: 30px;
      font-size: 18px;
      color: #eee;
    }
    .leaderboard {
      margin-top: 50px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
    }
    .leaderboard h2 {
      margin-bottom: 10px;
    }
    .leaderboard ol {
      list-style: none;
      padding: 0;
    }
    .leaderboard li {
      margin: 6px 0;
    }
    .xp-box {
      position: absolute;
      top: 2px;
      left: 10px;
      background: linear-gradient(135deg, #a259ff, #8338ec);
      color: white;
      padding: 10px 16px;
      border-radius: 14px;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 0 10px #a259ff;
    }
    $1top: 0px;
      right: 10px;
    }
  </style>
</head>
<body>
  <div class="xp-box">✨ XP: <span id="xpCounter">0</span></div>
  <div class="connect-box" style="position: fixed; top: -4px; right: 10px; z-index: 10;">
    <button id="connectBtn" onclick="connect()">🔌 Connect Wallet</button>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab(event, 'pet-tab')">🐶 Pet The Dog</div>
    <div class="tab" onclick="showTab(event, 'gmgn-tab')">🌅 GM / GN</div>
    <div class="tab" onclick="showTab(event, 'flip-tab')">🪙 Flip Coin</div>
  </div>

  <div id="pet-tab" class="tab-content active">
    <h1>🐶 Pet The Dog</h1>
    <img src="https://placedog.net/400/300?id=7" alt="Cute dog" style="max-width:300px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.5);"><br>
    <button onclick="petDog()">Pet 🐕</button>
    <div class="leaderboard">
      <h2>🏆 Pet Leaderboard</h2>
      <ol id="pet-leaderboard">
        <li>Loading...</li>
      </ol>
    </div>
  </div>

  <div id="gmgn-tab" class="tab-content">
    <h1>🌅 Say GM or GN 🌙</h1>
    <button onclick="sayGM()">☀️ GM</button>
    <button onclick="sayGN()">🌙 GN</button>
    <div class="leaderboard">
      <h2>🏆 GM/GN Leaderboard</h2>
      <ol id="gmgn-leaderboard">
        <li>Loading...</li>
      </ol>
    </div>
  </div>

  <div id="flip-tab" class="tab-content">
    <h1>🪙 Flip Coin</h1>
    <div id="coin" style="font-size: 48px; margin: 20px;">🪙</div>
    <button onclick="flipMonad()">Flip Coin</button>
    <div class="info" id="flipResult">Flip result: -</div>
    <div class="leaderboard">
      <h2>🏆 Flip Leaderboard</h2>
      <ol id="flip-leaderboard">
        <li>Loading...</li>
      </ol>
    </div>
  </div>

  <script>
    const FLIP_CONTRACT_ADDRESS = "0xc5b2280d1e2f155f9a2be2af7e78190658874106";
    const FLIP_ABI = [
      "function flip() public",
      "function getMyFlips(address) public view returns (uint256)"
    ];

    const GREET_CONTRACT_ADDRESS = "0xbc8b78f3e2348d4b5e0390fe700ce54b59931da4";
    const GREET_ABI = [
      "function gm() public",
      "function gn() public"
    ];

    let provider, signer, userAddress, flipContract;
    let userXP = 0;
    let lastVisit = localStorage.getItem("lastVisit");
    let today = new Date().toDateString();
    let dailyMultiplier = (lastVisit === today) ? 2 : 1;
    localStorage.setItem("lastVisit", today);

    async function connect() {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();
      flipContract = new ethers.Contract(FLIP_CONTRACT_ADDRESS, FLIP_ABI, signer);
      document.getElementById("connectBtn").innerText = `🟢 ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
      updateFlipLeaderboard();
      updatePetLeaderboard();
      updateGmGnLeaderboard();
    }

    function addXP(amount) {
      const gain = amount * dailyMultiplier;
      userXP += gain;
      document.getElementById("xpCounter").innerText = userXP;
    }

    function showTab(event, id) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(id)?.classList.add('active');
    }

    async function petDog() {
      if (!signer) return alert("Connect wallet first");
      const petContract = new ethers.Contract("0xc53abe4c593b9440407f8ac1b346f3f999e6d8ed", [
        "function pet() public",
        "function getMyPets(address) public view returns (uint256)"
      ], signer);
      try {
        const tx = await petContract.pet();
        await tx.wait();
        addXP(10);
        alert("You pet the dog!");
        updatePetLeaderboard();
      } catch (e) {
        console.error(e);
        alert("Pet tx failed");
      }
    }

    async function sayGM() {
      if (!signer) return alert("Connect wallet first");
      const greetContract = new ethers.Contract(GREET_CONTRACT_ADDRESS, GREET_ABI, signer);
      try {
        const tx = await greetContract.gm();
        await tx.wait();
        addXP(5);
        alert("☀️ You said GM!");
      } catch (e) {
        console.error(e);
        alert("GM failed");
      }
    }

    async function sayGN() {
      if (!signer) return alert("Connect wallet first");
      const greetContract = new ethers.Contract(GREET_CONTRACT_ADDRESS, GREET_ABI, signer);
      try {
        const tx = await greetContract.gn();
        await tx.wait();
        addXP(5);
        alert("🌙 You said GN!");
      } catch (e) {
        console.error(e);
        alert("GN failed");
      }
    }

    async function flipMonad() {
      if (!signer || !flipContract) return alert("Connect wallet first");
      const coin = document.getElementById("coin");
      const isHeads = Math.random() < 0.5;
      const result = isHeads ? "HEADS" : "TAILS";
      coin.style.transform = `rotateY(${isHeads ? 0 : 180}deg)`;
      try {
        const tx = await flipContract.flip();
        await tx.wait();
        addXP(3);
        document.getElementById("flipResult").innerText = `Flip result: ${result}`;
        updateFlipLeaderboard();
      } catch (e) {
        console.error(e);
        alert("Flip tx failed");
      }
    }

    async function updateFlipLeaderboard() {
      const list = document.getElementById('flip-leaderboard');
      if (!list || !provider) return;
      list.innerHTML = '';
      const addresses = [userAddress];
      for (let addr of addresses) {
        try {
          const contract = new ethers.Contract(FLIP_CONTRACT_ADDRESS, FLIP_ABI, provider);
          const flips = await contract.getMyFlips(addr);
          const li = document.createElement('li');
          li.textContent = `${addr.slice(0, 6)}...${addr.slice(-4)} — ${flips} flips`;
          list.appendChild(li);
        } catch (err) {
          console.error("Error loading flips for", addr, err);
        }
      }
    }
  </script>
</body>
</html>
