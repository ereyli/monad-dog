<head>
  <link rel="icon" type="image/png" href="https://monad-dog.vercel.app/icon.png">
  <link rel="manifest" href="/manifest.json">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Farcaster Mini App Meta -->
  <meta name="fc:frame" content='{
  "version": "next",
  "imageUrl": "https://monad-dog.vercel.app/icon.png",
  "button": {
    "title": "Launch App",
    "action": {
      "type": "launch_frame",
      "url": "https://monad-dog.vercel.app",
      "splashImageUrl": "https://monad-dog.vercel.app/icon.png",
      "splashBackgroundColor": "#2d014d"
    }
  }
}' />


  <title>Monad Test App</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <!-- Sadece Farcaster ortamÄ±nda yÃ¼klenen SDK -->
  <script>
    // Performans iÃ§in modÃ¼l yÃ¼klemelerini ÅŸartlÄ± olarak yap
    window.loadFarcasterSDK = function() {
      // EÄŸer zaten SDK yÃ¼klenmiÅŸse yÃ¼kleme
      if (window.sdk) return Promise.resolve(window.sdk);
      
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.type = 'module';
        script.innerHTML = `
          import { sdk } from 'https://esm.sh/@farcaster/frame-sdk';
          window.sdk = sdk;
          sdk.actions.ready().then(() => {
            document.dispatchEvent(new Event('farcasterReady'));
          });
        `;
        script.onerror = reject;
        document.head.appendChild(script);
        
        // SDK hazÄ±r olduÄŸunda resolve edilir
        document.addEventListener('farcasterReady', () => resolve(window.sdk));
      });
    };
    
    // URL'de Farcaster belirteci varsa SDK'yÄ± otomatik olarak yÃ¼kle
    const url = new URL(window.location.href);
    if (url.searchParams.get('miniApp') === 'true' || 
        url.pathname.startsWith('/mini') || 
        window.location.href.includes('warpcast.com')) {
      window.loadFarcasterSDK();
    }
  </script>
  <style>
    /* CSS deÄŸiÅŸmedi */
    html {
      box-sizing: border-box;
      font-size: 16px;
    }

    *, *:before, *:after {
      box-sizing: inherit;
    }


    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      color: #ffffff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    /* ... Ã–nceki CSS kodlarÄ± ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- HTML iÃ§eriÄŸi deÄŸiÅŸmedi -->
    <div class="header">
      <div class="xp-box">âœ¨ XP: <span id="xpCounter" class="xp-value">0</span></div>
      <div class="connect-box">
        <button id="connectBtn"><span class="button-icon">ğŸ”Œ</span> Connect Wallet</button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="showTab(event, 'pet-tab')">ğŸ¶ Pet The Dog</div>
      <div class="tab" onclick="showTab(event, 'gmgn-tab')">ğŸŒ… GM / GN</div>
      <div class="tab" onclick="showTab(event, 'flip-tab')">ğŸª™ Flip Coin</div>
      <div class="tab" onclick="showTab(event, 'leaderboard-tab')">ğŸ† Leaderboard</div>
    </div>

    <div id="pet-tab" class="tab-content active">
      <h1>ğŸ¶ Pet The Adorable Dog</h1>
      <img id="dogImage" src="https://placedog.net/400/300?id=7" alt="Cute dog"><br>
      <button onclick="petDog()"><span class="button-icon">ğŸ‘‹</span> Pet Dog</button>
      <div id="petStatus" class="transaction-status status-pending">Transaction in progress...</div>
    </div>

    <div id="gmgn-tab" class="tab-content">
      <h1>ğŸŒ… Good Morning / Good Night</h1>
      <p>Greet the Monad community with GM in the morning or GN in the evening!</p>
      <div class="gm-gn-buttons">
        <button onclick="sayGM()"><span class="button-icon">â˜€ï¸</span> Say GM</button>
        <button onclick="sayGN()"><span class="button-icon">ğŸŒ™</span> Say GN</button>
      </div>
      <div id="greetStatus" class="transaction-status status-pending">Transaction in progress...</div>
    </div>

    <div id="flip-tab" class="tab-content">
      <h1>ğŸª™ Flip the Monad Coin</h1>
      <div id="coin">ğŸª™</div>
      <button onclick="flipMonad()"><span class="button-icon">ğŸ²</span> Flip Coin</button>
      <div class="info" id="flipResult">Flip result will appear here</div>
      <div id="flipStatus" class="transaction-status status-pending">Transaction in progress...</div>
    </div>
    
    <div id="leaderboard-tab" class="tab-content">
      <h1>ğŸ† Monad Activity Leaderboard</h1>
      <p>Top users by number of transactions on Monad Testnet</p>
      
      <div class="leaderboard-table-container">
        <table class="leaderboard-table">
          <thead>
            <tr>
              <th class="rank">#</th>
              <th class="wallet-address">Wallet</th>
              <th class="tx-count">Transactions</th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- Leaderboard data will be populated here -->
          </tbody>
        </table>
      </div>
      
      <button onclick="refreshLeaderboard()" style="margin-top: 30px;"><span class="button-icon">ğŸ”„</span> Refresh Leaderboard</button>
    </div>
  </div>

  <script>
    const FLIP_CONTRACT_ADDRESS = "0xc5b2280d1e2f155f9a2be2af7e78190658874106";
    const GREET_CONTRACT_ADDRESS = "0xbc8b78f3e2348d4b5e0390fe700ce54b59931da4";
    const PET_CONTRACT_ADDRESS = "0xc53abe4c593b9440407f8ac1b346f3f999e6d8ed";

    const FLIP_ABI = ["function flip() public"];
    const GREET_ABI = ["function gm() public", "function gn() public"];
    const PET_ABI = ["function pet() public"];

    let provider, signer, userAddress, flipContract;
    let userXP = 0;
    let isConnected = false;
    let isFarcasterWallet = false;
    let farcasterSDKLoaded = false;

    // Daha verimli Farcaster context kontrolÃ¼
    async function checkFarcasterEnvironment() {
      // Basit URL tabanlÄ± kontrol, daha hÄ±zlÄ±
      const url = new URL(window.location.href);
      const queryParam = url.searchParams.get('miniApp');
      const pathCheck = url.pathname.startsWith('/mini');
      const hostCheck = window.location.href.includes('warpcast.com');
      
      if (queryParam === 'true' || pathCheck || hostCheck) {
        try {
          if (!window.sdk) {
            await window.loadFarcasterSDK();
          }
          farcasterSDKLoaded = true;
          return true;
        } catch (e) {
          console.error("Failed to load Farcaster SDK:", e);
        }
      }
      return false;
    }

    // Farcaster context bilgilerini almak iÃ§in
    async function getFarcasterContext() {
      if (!farcasterSDKLoaded) return null;
      
      try {
        if (window.sdk && window.sdk.context) {
          const context = window.sdk.context;
          
          // KullanÄ±cÄ± bilgilerini kontrol et
          if (context && context.user && context.user.fid) {
            document.getElementById("xpCounter").innerText = context.user.fid;
            
            if (context.user.username) {
              const btn = document.getElementById("connectBtn");
              btn.innerHTML = `<span class="button-icon">ğŸŸ¢</span> @${context.user.username}`;
            }
          }
          
          return context;
        }
      } catch (e) {
        console.error("Failed to get Farcaster context:", e);
      }
      return null;
    }

    function disconnect() {
      provider = null;
      signer = null;
      userAddress = null;
      isConnected = false;
      isFarcasterWallet = false;
      document.getElementById("connectBtn").innerHTML = '<span class="button-icon">ğŸ”Œ</span> Connect Wallet';
    }

    async function handleWalletConnection() {
      if (isConnected) {
        disconnect();
        return;
      }
      
      // Farcaster Mini App iÃ§inde Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol et
      const isFarcasterEnvironment = await checkFarcasterEnvironment();
      
      if (isFarcasterEnvironment) {
        // Farcaster cÃ¼zdanÄ±nÄ± kullan
        await connectFarcasterWallet();
      } else {
        // Normal web3 cÃ¼zdanÄ± kullan
        await connect();
      }
    }

    async function connectFarcasterWallet() {
      try {
        if (!farcasterSDKLoaded) {
          await window.loadFarcasterSDK();
          farcasterSDKLoaded = true;
        }
        
        // Farcaster wallet provider'Ä± al
        if (window.sdk && window.sdk.wallet && window.sdk.wallet.ethProvider) {
          // Farcaster cÃ¼zdanÄ±nÄ± kullan
          provider = new ethers.providers.Web3Provider(window.sdk.wallet.ethProvider);
          
          // Signer ve adres bilgilerini al
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          console.log("Connected to Farcaster wallet:", userAddress);
          
          // SÃ¶zleÅŸmeleri tanÄ±mla
          flipContract = new ethers.Contract(FLIP_CONTRACT_ADDRESS, FLIP_ABI, signer);
          
          // DÃ¼ÄŸme gÃ¼ncelleme
          isConnected = true;
          isFarcasterWallet = true;
          document.getElementById("connectBtn").innerHTML = `<span class="button-icon">ğŸŸ¢</span> ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
          
          // Farcaster kullanÄ±cÄ± bilgilerini al ve gÃ¶ster
          const context = await getFarcasterContext();
          if (context && context.user && context.user.username) {
            document.getElementById("connectBtn").innerHTML = `<span class="button-icon">ğŸŸ¢</span> @${context.user.username}`;
          }
          
          // Leaderboard'da kullanÄ±cÄ±yÄ± vurgula
          highlightUserOnLeaderboard();
          
          return true;
        } else {
          console.log("Farcaster wallet not available, using regular connect");
          // Farcaster cÃ¼zdanÄ± yoksa normal baÄŸlantÄ±ya geri dÃ¶n
          return await connect();
        }
      } catch (error) {
        console.error("Farcaster wallet connection error:", error);
        alert("Farcaster wallet connection failed: " + (error.message || "Unknown error"));
        return false;
      }
    }

    async function connect() {
      // Standart MetaMask baÄŸlantÄ±sÄ± - deÄŸiÅŸmedi
      const MONAD_TESTNET_CHAIN_ID = 10143;
      const targetNetworkName = "Monad Testnet";

      if (!window.ethereum) {
        alert("MetaMask is not installed");
        return;
      }

      try {
        // Request account access
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        
        // Check network
        const network = await provider.getNetwork();
        console.log("Connected to network:", network);
        
        if (network.chainId !== MONAD_TESTNET_CHAIN_ID) {
          try {
            // Try to switch network
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x' + MONAD_TESTNET_CHAIN_ID.toString(16) }],
            });
            
            // Refresh provider after network switch
            provider = new ethers.providers.Web3Provider(window.ethereum);
          } catch (switchError) {
            console.error("Network switch error:", switchError);
            
            // Try to add the network if it doesn't exist
            try {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: '0x' + MONAD_TESTNET_CHAIN_ID.toString(16),
                  chainName: 'Monad Testnet',
                  nativeCurrency: {
                    name: 'Monad',
                    symbol: 'MONAD',
                    decimals: 18
                  },
                  rpcUrls: ['https://rpc.monad.xyz/monad-testnet'],
                  blockExplorerUrls: ['https://explorer.monad.xyz/']
                }]
              });
              
              // Refresh provider after network add
              provider = new ethers.providers.Web3Provider(window.ethereum);
            } catch (addError) {
              console.error("Add network error:", addError);
              alert(`Please manually switch to ${targetNetworkName} in your wallet.`);
              return;
            }
          }
        }
        
        // Get signer and address
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        console.log("Connected to address:", userAddress);
        
        // Initialize contracts with this signer
        flipContract = new ethers.Contract(FLIP_CONTRACT_ADDRESS, FLIP_ABI, signer);
        
        // Update button and status
        isConnected = true;
        document.getElementById("connectBtn").innerHTML = `<span class="button-icon">ğŸŸ¢</span> ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
        
        // Check if user is on the leaderboard and highlight their entry
        highlightUserOnLeaderboard();
      } catch (error) {
        console.error("Connection error:", error);
        alert("Wallet connection failed: " + (error.message || "Unknown error"));
      }
    }

    function addXP(amount) {
      userXP += amount;
      document.getElementById("xpCounter").innerText = userXP;
    }

    function showTab(event, id) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(id).classList.add('active');
    }

    // Farcaster ile iÅŸlem gÃ¶nderme iÃ§in yardÄ±mcÄ± fonksiyon - daha basit versiyonu
    async function sendTransaction(contract, method, args = []) {
      const gasLimit = 1000000;
      
      try {
        const tx = await contract[method](...args, { gasLimit });
        console.log(`${method} transaction hash:`, tx.hash);
        return tx;
      } catch (error) {
        console.error(`${method} transaction error:`, error);
        throw error;
      }
    }

    async function flipMonad() {
      if (!isConnected) {
        alert("Connect wallet first");
        return;
      }
      
      const coin = document.getElementById("coin");
      const statusEl = document.getElementById("flipStatus");
      
      let spin = 0;
      document.getElementById("flipResult").innerText = "Flipping...";
      
      // Show pending status
      statusEl.textContent = "Transaction pending...";
      statusEl.className = "transaction-status status-pending visible";
      
      const spinning = setInterval(() => {
        spin += 36;
        coin.style.transform = `rotateY(${spin}deg)`;
      }, 100);
      
      try {
        // Re-create contract with current signer to ensure it's properly connected
        const flipContract = new ethers.Contract(FLIP_CONTRACT_ADDRESS, FLIP_ABI, signer);
        
        // Ä°ÅŸlem gÃ¶nder
        const tx = await sendTransaction(flipContract, "flip");
        
        // Show transaction hash
        statusEl.textContent = `Processing: ${tx.hash.slice(0,10)}...${tx.hash.slice(-6)}`;
        
        await tx.wait();
        clearInterval(spinning);
        
        const result = Math.random() < 0.5 ? "Heads" : "Tails";
        coin.style.transform = `rotateY(${result === "Heads" ? 0 : 180}deg)`;
        document.getElementById("flipResult").innerText = `âœ… Flip result: ${result}`;
        
        // Show success status
        statusEl.textContent = "Transaction successful!";
        statusEl.className = "transaction-status status-success visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 3000);
        
        addXP(3);
      } catch (e) {
        clearInterval(spinning);
        console.error("Flip error:", e);
        document.getElementById("flipResult").innerText = `âŒ Flip failed: ${e.message ? e.message.slice(0, 50) : "Unknown error"}`;
        
        // Show error status
        statusEl.textContent = `Error: ${e.message ? e.message.slice(0, 50) : "Unknown error"}`;
        statusEl.className = "transaction-status status-error visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 5000);
      }
    }

    async function petDog() {
      if (!isConnected) {
        alert("Connect wallet first");
        return;
      }
      
      const dogImage = document.getElementById('dogImage');
      const statusEl = document.getElementById("petStatus");
      
      // Show a new random dog
      dogImage.src = `https://placedog.net/400/300?id=${Math.floor(Math.random() * 50) + 1}`;
      
      // Show pending status
      statusEl.textContent = "Petting in progress...";
      statusEl.className = "transaction-status status-pending visible";
      
      try {
        // Re-create contract with current signer to ensure it's properly connected
        const petContract = new ethers.Contract(PET_CONTRACT_ADDRESS, PET_ABI, signer);
        
        // Ä°ÅŸlem gÃ¶nder
        const tx = await sendTransaction(petContract, "pet");
        
        // Show transaction hash
        statusEl.textContent = `Processing: ${tx.hash.slice(0,10)}...${tx.hash.slice(-6)}`;
        
        await tx.wait();
        
        // Show success status
        statusEl.textContent = "Dog successfully petted! ğŸ¶";
        statusEl.className = "transaction-status status-success visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 3000);
        
        addXP(10);
      } catch (e) {
        console.error("Pet error:", e);
        
        // Show error status
        statusEl.textContent = `Error: ${e.message ? e.message.slice(0, 50) : "Unknown error"}`;
        statusEl.className = "transaction-status status-error visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 5000);
      }
    }

    async function sayGM() {
      if (!isConnected) {
        alert("Connect wallet first");
        return;
      }
      
      const statusEl = document.getElementById("greetStatus");
      const buttonSpan = document.querySelector('button[onclick="sayGM()"] .button-icon');
      
      // Update button appearance
      document.querySelector('button[onclick="sayGM()"]').disabled = true;
      buttonSpan.textContent = "â³";
      
      // Show pending status
      statusEl.textContent = "Sending GM to the blockchain...";
      statusEl.className = "transaction-status status-pending visible";
      
      try {
        // Re-create contract with current signer to ensure it's properly connected
        const greetContract = new ethers.Contract(GREET_CONTRACT_ADDRESS, GREET_ABI, signer);
        
        // Ä°ÅŸlem gÃ¶nder
        const tx = await sendTransaction(greetContract, "gm");
        
        // Show transaction hash
        statusEl.textContent = `Processing: ${tx.hash.slice(0,10)}...${tx.hash.slice(-6)}`;
        
        await tx.wait();
        
        // Update button appearance
        buttonSpan.textContent = "âœ…";
        setTimeout(() => {
          buttonSpan.textContent = "â˜€ï¸";
          document.querySelector('button[onclick="sayGM()"]').disabled = false;
        }, 3000);
        
        // Show success status
        statusEl.textContent = "GM successfully sent to the community!";
        statusEl.className = "transaction-status status-success visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 3000);
        
        addXP(5);
      } catch (e) {
        // Update button appearance
        buttonSpan.textContent = "âŒ";
        setTimeout(() => {
          buttonSpan.textContent = "â˜€ï¸";
          document.querySelector('button[onclick="sayGM()"]').disabled = false;
        }, 3000);
        
        console.error("GM error:", e);
        
        // Show error status
        statusEl.textContent = `Error: ${e.message ? e.message.slice(0, 50) : "Unknown error"}`;
        statusEl.className = "transaction-status status-error visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 5000);
      }
    }

    async function sayGN() {
      if (!isConnected) {
        alert("Connect wallet first");
        return;
      }
      
      const statusEl = document.getElementById("greetStatus");
      const buttonSpan = document.querySelector('button[onclick="sayGN()"] .button-icon');
      
      // Update button appearance
      document.querySelector('button[onclick="sayGN()"]').disabled = true;
      buttonSpan.textContent = "â³";
      
      // Show pending status
      statusEl.textContent = "Sending GN to the blockchain...";
      statusEl.className = "transaction-status status-pending visible";
      
      try {
        // Re-create contract with current signer to ensure it's properly connected
        const greetContract = new ethers.Contract(GREET_CONTRACT_ADDRESS, GREET_ABI, signer);
        
        // Ä°ÅŸlem gÃ¶nder
        const tx = await sendTransaction(greetContract, "gn");
        
        // Show transaction hash
        statusEl.textContent = `Processing: ${tx.hash.slice(0,10)}...${tx.hash.slice(-6)}`;
        
        await tx.wait();
        
        // Update button appearance
        buttonSpan.textContent = "âœ…";
        setTimeout(() => {
          buttonSpan.textContent = "ğŸŒ™";
          document.querySelector('button[onclick="sayGN()"]').disabled = false;
        }, 3000);
        
        // Show success status
        statusEl.textContent = "GN successfully sent to the community!";
        statusEl.className = "transaction-status status-success visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 3000);
        
        addXP(5);
      } catch (e) {
        // Update button appearance
        buttonSpan.textContent = "âŒ";
        setTimeout(() => {
          buttonSpan.textContent = "ğŸŒ™";
          document.querySelector('button[onclick="sayGN()"]').disabled = false;
        }, 3000);
        
        console.error("GN error:", e);
        
        // Show error status
        statusEl.textContent = `Error: ${e.message ? e.message.slice(0, 50) : "Unknown error"}`;
        statusEl.className = "transaction-status status-error visible";
        setTimeout(() => {
          statusEl.className = "transaction-status";
        }, 5000);
      }
    }

    // Leaderboard related functions - unchanged
    const leaderboardData = [
      { rank: 1, address: "0x742e791fe67e08c5fc9e1978efa8b8d881e426da", txCount: 278, badge: "Early Adopter" },
      { rank: 2, address: "0x934a2b0b5f709a0d59845beddc3e698b9ad9621c", txCount: 203 },
      { rank: 3, address: "0x1fa369d46516e4e0150b48b5b0f4880d3f8f257a", txCount: 186, badge: "VIP" },
      { rank: 4, address: "0x6b78e84a68bf1df348542d8fd2b9bd1a7ce2b954", txCount: 149 },
      { rank: 5, address: "0x8392f8fe8fe2535d5764f693a146b01acfd29824", txCount: 134 },
      { rank: 6, address: "0xc54abf65c24a48e94f43609f5d4e65416853f3ac", txCount: 112 },
      { rank: 7, address: "0x3a1d9e24bd7aea22a99177a3c28e3fe71f4e6b1e", txCount: 98, badge: "Builder" },
      { rank: 8, address: "0x925f1b78d5ccf2e4b652dc9c4c748195f3d9bf4e", txCount: 87 },
      { rank: 9, address: "0x2d3856a85a7a6eb8d7932f48d3fd738a83f6bc12", txCount: 76 },
      { rank: 10, address: "0xf432b9d3fe8cfd8d8fcf347841a27edaef6b37d1", txCount: 63 }
    ];
    
    function maskAddress(address) {
      if (!address) return "";
      return address.substring(0, 6) + "..." + address.substring(address.length - 4);
    }
    
    function populateLeaderboard() {
      const tbody = document.getElementById("leaderboardBody");
      tbody.innerHTML = "";
      
      leaderboardData.forEach(item => {
        const row = document.createElement("tr");
        
        // Rank cell
        const rankCell = document.createElement("td");
        rankCell.className = "rank";
        rankCell.textContent = "#" + item.rank;
        
        // Address cell
        const addressCell = document.createElement("td");
        addressCell.className = "wallet-address";
        addressCell.textContent = maskAddress(item.address);
        
        // Add badge if exists
        if (item.badge) {
          const badge = document.createElement("span");
          badge.className = "badge";
          badge.textContent = item.badge;
          addressCell.appendChild(badge);
        }
        
        // TX count cell
        const txCell = document.createElement("td");
        txCell.className = "tx-count";
        txCell.textContent = item.txCount;
        
        // Append all cells to row
        row.appendChild(rankCell);
        row.appendChild(addressCell);
        row.appendChild(txCell);
        
        // Highlight user's address if connected
        if (isConnected && userAddress && item.address.toLowerCase() === userAddress.toLowerCase()) {
          row.style.background = "rgba(162, 89, 255, 0.3)";
          row.style.fontWeight = "bold";
        }
        
        // Add row to table
        tbody.appendChild(row);
      });
    }
    
    function refreshLeaderboard() {
      document.getElementById("leaderboardBody").innerHTML = `
        <tr>
          <td colspan="3" style="text-align: center; padding: 30px;">
            Loading leaderboard data...
          </td>
        </tr>
      `;
      
      setTimeout(() => {
        populateLeaderboard();
        highlightUserOnLeaderboard();
      }, 1000);
    }
    
    function highlightUserOnLeaderboard() {
      if (!isConnected || !userAddress) return;
      
      const rows = document.querySelectorAll("#leaderboardBody tr");
      rows.forEach(row => {
        const addressCell = row.querySelector(".wallet-address");
        if (addressCell && addressCell.textContent.includes(userAddress.substring(0, 4))) {
          row.style.background = "rgba(162, 89, 255, 0.3)";
          row.style.fontWeight = "bold";
        }
      });
    }

    // Initialize when DOM is loaded - lazier initialization
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById("connectBtn").onclick = handleWalletConnection;
      populateLeaderboard();
      
      // Farcaster ortamÄ±nÄ± kontrol et, URL belirteci varsa Farcaster cÃ¼zdanÄ±nÄ± kullan
      const url = new URL(window.location.href);
      if (url.searchParams.get('miniApp') === 'true' || 
          url.pathname.startsWith('/mini') || 
          window.location.href.includes('warpcast.com')) {
        
        // Sayfa tamamen yÃ¼klendikten sonra Farcaster SDK'yÄ± yÃ¼kle ve baÄŸlan
        // Gecikmeli baÅŸlatma iÃ§in setTimeout kullan
        setTimeout(async () => {
          try {
            await checkFarcasterEnvironment();
            if (farcasterSDKLoaded) {
              await connectFarcasterWallet();
            }
          } catch (e) {
            console.error("Error auto-connecting to Farcaster:", e);
          }
        }, 500); // Sayfa yÃ¼klemesinin tamamlanmasÄ± iÃ§in bekle
      }
    });
  </script>

  <script>
    // SDK hazÄ±r olduÄŸunda Ã§aÄŸrÄ±lacak
    document.addEventListener('farcasterReady', async () => {
      // SDK hazÄ±r olduÄŸunda SDK'nÄ±n Splash ekranÄ±nÄ± kaldÄ±r
      if (window.sdk) {
        try {
          console.log("Farcaster SDK initialized");
        } catch (error) {
          console.error("Error using Farcaster SDK:", error);
        }
      }
    });
  </script>
</body>
