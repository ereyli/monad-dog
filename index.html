<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monad Dog</title>
  
  <!-- Farcaster Meta -->
  <meta name="fc:frame" content='{
    "version": "next",
    "imageUrl": "https://monad-dog.vercel.app/icon.png",
    "button": {
      "title": "Launch App",
      "action": {
        "type": "launch_frame",
        "url": "https://monad-dog.vercel.app"
      }
    }
  }' />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      color: white;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .xp {
      background: rgba(255,255,255,0.1);
      padding: 10px 20px;
      border-radius: 20px;
      display: inline-block;
      margin-bottom: 20px;
    }
    
    .wallet-section {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
    }
    
    button:hover {
      background: #5855e8;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .tabs {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    
    .tab.active {
      background: #6366f1;
    }
    
    .content {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      min-height: 200px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .dog-image {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      margin: 20px auto;
      display: block;
    }
    
    .coin {
      font-size: 60px;
      margin: 20px;
      transition: transform 0.5s;
    }
    
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      display: none;
    }
    
    .status.visible {
      display: block;
    }
    
    .status.success {
      background: rgba(0,255,0,0.2);
      color: #00ff00;
    }
    
    .status.error {
      background: rgba(255,0,0,0.2);
      color: #ff6b6b;
    }
    
    .status.pending {
      background: rgba(255,255,0,0.2);
      color: #ffeb3b;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    th {
      background: rgba(255,255,255,0.1);
    }
    
    .address {
      font-family: monospace;
      font-size: 12px;
    }

    .badge {
      background: #ff6b9d;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 500;
      margin-left: 8px;
    }

    .rank-number {
      font-weight: 600;
      color: #6366f1;
      width: 40px;
    }

    .address-cell {
      font-family: monospace;
      font-size: 12px;
    }

    .tx-count {
      font-weight: 600;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">üêï Monad Dog</div>
      <div class="xp">‚ú® XP: <span id="xp">0</span></div>
    </div>

    <div class="wallet-section">
      <div id="connect-area">
        <button id="connect-btn">üü£ Connect Wallet</button>
      </div>
      <div id="connected-area" style="display: none;">
        <div>üü£ Connected</div>
        <div id="address" class="address"></div>
        <button id="disconnect-btn">Disconnect</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('pet')">üêï Pet</button>
      <button class="tab" onclick="showTab('greet')">üëã Greet</button>
      <button class="tab" onclick="showTab('flip')">ü™ô Flip</button>
      <button class="tab" onclick="showTab('leaderboard')">üèÜ Ranks</button>
    </div>

    <div class="content">
      <!-- Pet Tab -->
      <div id="pet" class="tab-content active">
        <h3>Pet the Dog</h3>
        <img id="dog-img" class="dog-image" src="https://placedog.net/400/300?id=7" alt="Dog">
        <button onclick="petDog()">üëã Pet Dog (+10 XP)</button>
        <div id="pet-status" class="status"></div>
      </div>

      <!-- Greet Tab -->
      <div id="greet" class="tab-content">
        <h3>Greet Community</h3>
        <p>Say GM or GN to the community!</p>
        <button onclick="sayGM()">‚òÄÔ∏è Good Morning (+5 XP)</button>
        <button onclick="sayGN()">üåô Good Night (+5 XP)</button>
        <div id="greet-status" class="status"></div>
      </div>

      <!-- Flip Tab -->
      <div id="flip" class="tab-content">
        <h3>Flip Coin</h3>
        <div class="coin" id="coin">ü™ô</div>
        <button onclick="flipCoin()">üé≤ Flip Coin (+3 XP)</button>
        <div id="flip-result">Result will appear here</div>
        <div id="flip-status" class="status"></div>
      </div>

      <!-- Leaderboard Tab -->
      <div id="leaderboard" class="tab-content">
        <h3>Monad Dog Leaderboard</h3>
        <p style="font-size: 12px; opacity: 0.7; margin-bottom: 15px;">Top players by contract interactions</p>
        <table>
          <thead>
            <tr><th>Rank</th><th>Address</th><th>Interactions</th></tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- Populated by JavaScript -->
          </tbody>
        </table>
        <button onclick="refreshLeaderboard()" style="margin-top: 16px; width: auto; padding: 8px 16px; font-size: 12px;">
          üîÑ Refresh
        </button>
      </div>
    </div>

    <div id="loading" class="loading">Loading...</div>
  </div>

  <script>
    console.log('üöÄ Starting app...');
    
    // Global state 
    let appState = {
      connected: false,
      address: null,
      xp: 0,
      provider: null,
      signer: null
    };

    // Show loading initially
    document.getElementById('loading').style.display = 'block';

    // Contract addresses and ABIs
    const CONTRACTS = {
      PET: "0xc53abe4c593b9440407f8ac1b346f3f999e6d8ed",
      GREET: "0xbc8b78f3e2348d4b5e0390fe700ce54b59931da4",
      FLIP: "0xc5b2280d1e2f155f9a2be2af7e78190658874106"
    };

    const ABIS = {
      PET: ["function pet() public"],
      GREET: ["function gm() public", "function gn() public"],
      FLIP: ["function flip() public"]
    };

    // Wallet-specific XP management
    function getWalletXP(address) {
      if (!address) return 0;
      const key = `wallet_xp_${address.toLowerCase()}`;
      return parseInt(localStorage.getItem(key) || '0');
    }

    function saveWalletXP(address, xp) {
      if (!address) return;
      const key = `wallet_xp_${address.toLowerCase()}`;
      localStorage.setItem(key, xp.toString());
      console.log(`üíæ XP saved for ${address}: ${xp}`);
    }

    function updateXPDisplay() {
      if (appState.connected && appState.address) {
        const walletXP = getWalletXP(appState.address);
        document.getElementById('xp').textContent = walletXP;
        appState.xp = walletXP;
        console.log(`üìä XP loaded for ${appState.address}: ${walletXP}`);
      } else {
        document.getElementById('xp').textContent = '0';
        appState.xp = 0;
      }
    }

    // Contract interaction tracking
    function getContractInteractions(address) {
      const key = `contract_interactions_${address.toLowerCase()}`;
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : {
        pet: 0,
        gm: 0,
        gn: 0,
        flip: 0,
        total: 0,
        firstInteraction: null,
        lastInteraction: null
      };
    }

    function saveContractInteraction(address, contractType) {
      const key = `contract_interactions_${address.toLowerCase()}`;
      const data = getContractInteractions(address);
      
      data[contractType] = (data[contractType] || 0) + 1;
      data.total = data.pet + data.gm + data.gn + data.flip;
      data.lastInteraction = new Date().toISOString();
      
      if (!data.firstInteraction) {
        data.firstInteraction = new Date().toISOString();
      }
      
      localStorage.setItem(key, JSON.stringify(data));
      
      console.log(`üìä Contract interaction saved: ${contractType} for ${address}`);
      console.log(`üìà Total interactions: ${data.total}`);
      
      return data;
    }

    function getAllContractInteractions() {
      const allUsers = [];
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_interactions_')) {
          const address = key.replace('contract_interactions_', '');
          const data = JSON.parse(localStorage.getItem(key));
          
          if (data.total > 0) {
            allUsers.push({
              address: address,
              ...data
            });
          }
        }
      }
      
      allUsers.sort((a, b) => b.total - a.total);
      return allUsers;
    }

    function getBadgeForInteractions(interactions) {
      const { total } = interactions;
      
      if (total >= 100) return "Legend";
      if (total >= 50) return "Master";
      if (total >= 25) return "Expert"; 
      if (total >= 10) return "Active";
      if (total >= 5) return "Regular";
      if (total >= 1) return "Newbie";
      return "";
    }

    function getActivityBadge(interactions) {
      const { pet, gm, gn, flip } = interactions;
      
      if (pet >= 20) return "Dog Lover üêï";
      if (gm + gn >= 30) return "Community Spirit üëã";
      if (flip >= 25) return "Lucky Gambler üé∞";
      if (pet >= 10 && gm + gn >= 10 && flip >= 10) return "All-Rounder ‚≠ê";
      
      return "";
    }

    function getContractType(contractAddress, methodName) {
      if (contractAddress === CONTRACTS.PET && methodName === 'pet') return 'pet';
      if (contractAddress === CONTRACTS.GREET && methodName === 'gm') return 'gm';
      if (contractAddress === CONTRACTS.GREET && methodName === 'gn') return 'gn';
      if (contractAddress === CONTRACTS.FLIP && methodName === 'flip') return 'flip';
      return 'unknown';
    }

    // Initialize SDK
    let sdk = null;
    
    async function initApp() {
      try {
        console.log('Initializing...');
        
        // Try to import SDK
        try {
          const module = await import('https://esm.sh/@farcaster/frame-sdk');
          sdk = module.sdk;
          console.log('SDK loaded:', !!sdk);
          
          if (sdk) {
            await sdk.actions.ready();
            console.log('SDK ready');
          }
        } catch (e) {
          console.log('SDK not available:', e.message);
        }

        // Setup UI
        setupEventListeners();
        setupGameFunctions();
        
        // Load leaderboard data
        await populateLeaderboard();
        
        hideLoading();
        
        console.log('‚úÖ App initialized successfully');
        
      } catch (error) {
        console.error('‚ùå Init error:', error);
        hideLoading();
        console.log('App will continue without some features');
      }
    }

    function setupEventListeners() {
      document.getElementById('connect-btn').onclick = connectWallet;
      document.getElementById('disconnect-btn').onclick = disconnect;
    }

    function setupGameFunctions() {
      // Define all game functions globally
      window.petDog = async function() {
        console.log('üêï Pet Dog clicked!');
        
        if (!appState.connected) {
          console.log('‚ùå Wallet not connected');
          showError('Connect wallet first');
          return;
        }
        
        console.log('‚úÖ Wallet connected, starting pet transaction');
        
        // Change dog image
        document.getElementById('dog-img').src = `https://placedog.net/400/300?id=${Math.floor(Math.random() * 50) + 1}`;
        
        // Execute real blockchain transaction
        await executeTransaction(
          CONTRACTS.PET,
          ABIS.PET,
          'pet',
          'pet-status',
          'üêï Dog petted successfully! +10 XP',
          10
        );
      };

      window.sayGM = async function() {
        console.log('‚òÄÔ∏è Say GM clicked!');
        
        if (!appState.connected) {
          showError('Connect wallet first');
          return;
        }
        
        await executeTransaction(
          CONTRACTS.GREET,
          ABIS.GREET,
          'gm',
          'greet-status',
          '‚òÄÔ∏è Good Morning sent! +5 XP',
          5
        );
      };

      window.sayGN = async function() {
        console.log('üåô Say GN clicked!');
        
        if (!appState.connected) {
          showError('Connect wallet first');
          return;
        }
        
        await executeTransaction(
          CONTRACTS.GREET,
          ABIS.GREET,
          'gn',
          'greet-status',
          'üåô Good Night sent! +5 XP',
          5
        );
      };

      window.flipCoin = async function() {
        console.log('ü™ô Flip Coin clicked!');
        
        if (!appState.connected) {
          showError('Connect wallet first');
          return;
        }
        
        const coin = document.getElementById('coin');
        const result = document.getElementById('flip-result');
        
        // Start visual animation
        result.textContent = 'Flipping...';
        let rotation = 0;
        const interval = setInterval(() => {
          rotation += 180;
          coin.style.transform = `rotateY(${rotation}deg)`;
        }, 100);
        
        // Execute real transaction
        await executeTransaction(
          CONTRACTS.FLIP,
          ABIS.FLIP,
          'flip',
          'flip-status',
          'ü™ô Coin flipped! +3 XP',
          3
        );
        
        // Stop animation after transaction starts
        setTimeout(() => {
          clearInterval(interval);
          const finalResult = Math.random() < 0.5 ? 'Heads' : 'Tails';
          coin.style.transform = `rotateY(${finalResult === 'Heads' ? 0 : 180}deg)`;
          result.textContent = `Result: ${finalResult}!`;
        }, 3000);
      };

      window.showTab = function(tabName) {
        console.log('üìë Switching to tab:', tabName);
        
        // Update tabs
        document.querySelectorAll('.tab').forEach(tab => {
          tab.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Update content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(tabName).classList.add('active');
      };

      console.log('üéÆ Game functions setup complete');
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    async function connectWallet() {
      try {
        console.log('Connecting wallet...');
        
        let provider;
        
        if (sdk && sdk.wallet && sdk.wallet.ethProvider) {
          console.log('Using Farcaster wallet');
          provider = sdk.wallet.ethProvider;
        } else if (window.ethereum) {
          console.log('Using browser wallet');
          provider = window.ethereum;
        } else {
          throw new Error('No wallet available');
        }

        // Request accounts
        const accounts = await provider.request({
          method: 'eth_requestAccounts'
        });

        if (!accounts || accounts.length === 0) {
          throw new Error('No accounts found');
        }

        console.log('‚úÖ Connected:', accounts[0]);

        // Setup ethers
        appState.provider = new ethers.providers.Web3Provider(provider);
        appState.signer = appState.provider.getSigner();
        appState.address = accounts[0];
        appState.connected = true;

        // Update UI and load wallet-specific XP
        updateWalletUI();
        updateXPDisplay();

      } catch (error) {
        console.error('Connection error:', error);
        showError(error.message);
      }
    }

    function disconnect() {
      appState = {
        connected: false,
        address: null,
        xp: 0,
        provider: null,
        signer: null
      };
      updateWalletUI();
      updateXPDisplay();
      console.log('üîå Wallet disconnected, XP reset to 0');
    }

    function updateWalletUI() {
      const connectArea = document.getElementById('connect-area');
      const connectedArea = document.getElementById('connected-area');
      const addressEl = document.getElementById('address');

      if (appState.connected) {
        connectArea.style.display = 'none';
        connectedArea.style.display = 'block';
        addressEl.textContent = appState.address.slice(0,6) + '...' + appState.address.slice(-4);
      } else {
        connectArea.style.display = 'block';
        connectedArea.style.display = 'none';
      }
    }

    function addXP(amount) {
      if (!appState.connected || !appState.address) {
        console.log('‚ùå Cannot add XP: wallet not connected');
        return;
      }
      
      // Add XP to current wallet
      appState.xp += amount;
      
      // Save to localStorage for this specific wallet
      saveWalletXP(appState.address, appState.xp);
      
      // Update display
      document.getElementById('xp').textContent = appState.xp;
      
      // Add celebration effect
      const xpElement = document.getElementById('xp');
      xpElement.style.transform = 'scale(1.2)';
      xpElement.style.color = '#00ff00';
      
      setTimeout(() => {
        xpElement.style.transform = 'scale(1)';
        xpElement.style.color = 'white';
      }, 500);
      
      console.log(`‚ú® XP added to ${appState.address}: +${amount}, Total: ${appState.xp}`);
    }

    function showStatus(id, message, type) {
      const el = document.getElementById(id);
      el.textContent = message;
      el.className = `status visible ${type}`;
    }

    function hideStatus(id) {
      document.getElementById(id).className = 'status';
    }

    function showError(message) {
      const div = document.createElement('div');
      div.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(255,0,0,0.9);color:white;padding:10px 20px;border-radius:8px;z-index:1000;';
      div.textContent = message;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 5000);
    }

    // Real transaction function
    async function executeTransaction(contractAddress, abi, methodName, statusId, successMsg, xpAmount) {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }

      try {
        console.log('üîó Starting transaction:', methodName);
        showStatus(statusId, 'Preparing transaction...', 'pending');

        // Ensure Monad network
        await ensureMonadNetwork();

        // Create contract instance
        const contract = new ethers.Contract(contractAddress, abi, appState.signer);
        
        showStatus(statusId, 'üîê Please confirm in your wallet...', 'pending');

        // Send transaction
        const tx = await contract[methodName]({
          gasLimit: 1000000
        });

        console.log('‚úÖ Transaction sent:', tx.hash);
        showStatus(statusId, `‚úÖ Transaction sent: ${tx.hash.slice(0,10)}...`, 'pending');

        // Since Farcaster wallet doesn't support eth_getTransactionReceipt,
        // we'll assume success after a delay and track the interaction
        setTimeout(() => {
          console.log('‚úÖ Transaction assumed successful');
          showStatus(statusId, successMsg, 'success');
          addXP(xpAmount);
          
          // Track contract interaction
          if (appState.connected && appState.address) {
            const contractType = getContractType(contractAddress, methodName);
            const interactionData = saveContractInteraction(appState.address, contractType);
            console.log(`üéØ Contract interaction tracked: ${contractType}`);
          }
          
          setTimeout(() => hideStatus(statusId), 3000);
        }, 5000);

      } catch (error) {
        console.error('‚ùå Transaction error:', error);
        
        let errorMsg = 'Transaction failed';
        if (error.message.includes('user rejected') || error.code === 4001) {
          errorMsg = 'Transaction cancelled by user';
        } else if (error.message.includes('insufficient funds')) {
          errorMsg = 'Insufficient funds for gas';
        }

        showStatus(statusId, errorMsg, 'error');
        setTimeout(() => hideStatus(statusId), 5000);
      }
    }

    async function ensureMonadNetwork() {
      const MONAD_CHAIN_ID = '0x279F'; // 10143 in hex
      
      try {
        const provider = sdk && sdk.wallet && sdk.wallet.ethProvider 
          ? sdk.wallet.ethProvider 
          : window.ethereum;

        if (!provider) {
          throw new Error('No wallet provider available');
        }

        const chainId = await provider.request({ method: 'eth_chainId' });
        console.log('Current chain ID:', chainId);

        if (chainId !== MONAD_CHAIN_ID) {
          console.log('Switching to Monad Testnet...');
          
          try {
            await provider.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: MONAD_CHAIN_ID }],
            });
            console.log('Switched to Monad Testnet');
          } catch (switchError) {
            if (switchError.code === 4902) {
              console.log('Adding Monad Testnet...');
              await provider.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: MONAD_CHAIN_ID,
                  chainName: 'Monad Testnet',
                  nativeCurrency: {
                    name: 'Monad',
                    symbol: 'MONAD',
                    decimals: 18
                  },
                  rpcUrls: ['https://testnet-rpc.monad.xyz'],
                  blockExplorerUrls: ['https://testnet.monadscan.com/']
                }]
              });
              console.log('Monad Testnet added');
            }
          }

          // Recreate provider after network switch
          appState.provider = new ethers.providers.Web3Provider(provider);
          appState.signer = appState.provider.getSigner();
        }
      } catch (error) {
        console.error('Network switch error:', error);
        throw new Error('Failed to switch to Monad Testnet');
      }
    }

    async function populateLeaderboard() {
      const tbody = document.getElementById('leaderboardBody');
      if (!tbody) return;

      // Show loading state
      tbody.innerHTML = `
        <tr>
          <td colspan="3" style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">
            Loading contract interactions...
          </td>
        </tr>
      `;

      try {
        // Get all contract interactions from localStorage
        const contractUsers = getAllContractInteractions();
        
        console.log('üìä Found', contractUsers.length, 'users with contract interactions');
        
        if (contractUsers.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="3" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                <div>üåü Be the first to interact!</div>
                <div style="font-size: 11px; opacity: 0.7; margin-top: 8px;">
                  Pet the dog, say GM/GN, or flip coins to appear here
                </div>
              </td>
            </tr>
          `;
          return;
        }
        
        // Create leaderboard with contract interaction data
        const leaderboardData = contractUsers.map((user, index) => ({
          rank: index + 1,
          address: user.address,
          txCount: user.total,
          interactions: {
            pet: user.pet,
            gm: user.gm,
            gn: user.gn,
            flip: user.flip
          },
          badge: getBadgeForInteractions(user),
          activityBadge: getActivityBadge(user)
        }));
        
        // Populate table
        tbody.innerHTML = leaderboardData.map((item) => {
          const isCurrentUser = appState.connected && 
            item.address.toLowerCase() === appState.address?.toLowerCase();
          
          const interactionDetails = `üêï${item.interactions.pet} üëã${item.interactions.gm + item.interactions.gn} ü™ô${item.interactions.flip}`;
          
          return `
            <tr style="${isCurrentUser ? 'background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.5);' : ''}" 
                title="Pet: ${item.interactions.pet}, GM/GN: ${item.interactions.gm + item.interactions.gn}, Flip: ${item.interactions.flip}">
              <td class="rank-number">#${item.rank}</td>
              <td class="address-cell">
                <div>${item.address.slice(0,6)}...${item.address.slice(-4)}</div>
                <div style="font-size: 10px; opacity: 0.7; margin-top: 2px;">${interactionDetails}</div>
                ${item.activityBadge ? `<span class="badge" style="background: #ff6b9d;">${item.activityBadge}</span>` : ''}
                ${isCurrentUser ? '<span class="badge" style="background: #10b981;">You</span>' : ''}
              </td>
              <td class="tx-count">${item.txCount}</td>
            </tr>
          `;
        }).join('');

        console.log('‚úÖ Leaderboard populated with contract interaction data');

      } catch (error) {
        console.error('‚ùå Error populating leaderboard:', error);
        
        tbody.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; padding: 20px; color: #ff6b6b;">
              ‚ö†Ô∏è Failed to load leaderboard data
            </td>
          </tr>
        `;
      }
    }

    window.refreshLeaderboard = async function() {
      console.log('üîÑ Refreshing Monad Dog leaderboard...');
      await populateLeaderboard();
      console.log('‚úÖ Leaderboard refreshed with latest contract interactions');
    };

    // Debug functions for wallet-specific XP
    window.resetXP = function() {
      if (!appState.connected || !appState.address) {
        console.log('‚ùå No wallet connected to reset XP');
        return;
      }
      
      appState.xp = 0;
      saveWalletXP(appState.address, 0);
      document.getElementById('xp').textContent = '0';
      console.log(`üîÑ XP reset to 0 for wallet ${appState.address}`);
    };

    window.checkXP = function() {
      if (!appState.connected || !appState.address) {
        console.log('‚ùå No wallet connected');
        return 0;
      }
      
      console.log(`üíé Current XP for ${appState.address}:`, appState.xp);
      console.log(`üíæ Stored XP:`, getWalletXP(appState.address));
      return appState.xp;
    };

    window.getAllWalletsXP = function() {
      const allWallets = {};
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('wallet_xp_')) {
          const address = key.replace('wallet_xp_', '');
          const xp = parseInt(localStorage.getItem(key));
          allWallets[address] = xp;
        }
      }
      
      console.log('üéØ All wallets XP:', allWallets);
      return allWallets;
    };

    function showTab(tabName) {
      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');
    }

    // Start app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }

    console.log('üì± App script loaded');
  </script>
</body>
</html>
