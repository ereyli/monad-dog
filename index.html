<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monad Dog</title>

  <!-- Supabase Client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      color: white;
      min-height: 100vh;
      padding: 20px;
      margin: 0;
    }
    
    .container {
      max-width: 400px;
      margin: 0 auto;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .xp-claim-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .xp {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 12px 24px;
      border-radius: 25px;
      display: inline-block;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-weight: 500;
    }

    .claim-header-button {
      background: linear-gradient(135deg, #f59e0b, #eab308);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
      min-width: 140px;
      backdrop-filter: blur(10px);
    }

    .claim-header-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    }

    .claim-header-button.ready {
      background: linear-gradient(135deg, #10b981, #059669);
      animation: claim-pulse 2s ease-in-out infinite;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .claim-header-button.active {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }

    .claim-header-button:disabled {
      background: rgba(255,255,255,0.1);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      animation: none;
    }

    /* Leaderboard Styles */
    .leaderboard-container {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      margin: 10px 0;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      border-left: 4px solid #6366f1;
    }

    .rank {
      font-size: 24px;
      width: 40px;
    }

    .player {
      font-family: monospace;
      font-size: 14px;
      flex: 1;
      margin: 0 15px;
      opacity: 0.8;
    }

    .score {
      font-weight: 600;
      color: #f59e0b;
    }
    
    .wallet-section {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 24px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
    }
    
    button:hover {
      background: #5855e8;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .tabs-container {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      margin-bottom: 24px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tabs-row {
      display: flex;
      margin-bottom: 8px;
      gap: 8px;
    }

    .tabs-row:last-child {
      margin-bottom: 0;
    }
    
    .tab {
      flex: 1;
      padding: 12px 8px;
      background: rgba(255,255,255,0.05);
      border: none;
      color: white;
      cursor: pointer;
      font-size: 13px;
      white-space: nowrap;
      transition: all 0.3s ease;
      border-radius: 10px;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .tab:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-1px);
    }
    
    .tab.active {
      background: #6366f1;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      transform: translateY(-1px);
    }

    /* Special styling for claim tab */
    .claim-tab {
      background: linear-gradient(135deg, #f59e0b, #eab308);
      font-weight: 600;
      flex: 1.2; /* Make it slightly wider */
    }

    .claim-tab:hover {
      background: linear-gradient(135deg, #f59e0b, #eab308);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }

    .claim-tab.active {
      background: linear-gradient(135deg, #10b981, #059669);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .claim-badge {
      font-size: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      padding: 2px 6px;
      margin-top: 2px;
      display: inline-block;
      font-weight: 400;
    }

    .claim-tab.ready {
      animation: claim-pulse 2s ease-in-out infinite;
    }

    @keyframes claim-pulse {
      0%, 100% { 
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
        transform: scale(1.05);
      }
    }
    
    .content {
      background: rgba(255,255,255,0.03);
      backdrop-filter: blur(20px);
      padding: 24px;
      border-radius: 16px;
      text-align: center;
      min-height: 200px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .dog-image {
      width: 200px;
      height: 200px;
      border-radius: 12px;
      margin: 20px auto;
      display: block;
    }
    
    .coin {
      font-size: 60px;
      margin: 20px;
      transition: transform 0.5s;
    }
    
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      display: none;
    }
    
    .status.visible {
      display: block;
    }
    
    .status.success {
      background: rgba(0,255,0,0.2);
      color: #00ff00;
    }
    
    .status.error {
      background: rgba(255,0,0,0.2);
      color: #ff6b6b;
    }
    
    .status.pending {
      background: rgba(255,255,0,0.2);
      color: #ffeb3b;
    }
    
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: white;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.2);
      border-radius: 50%;
      border-top-color: #6366f1;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-text {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .app-content {
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .app-content.loaded {
      opacity: 1;
    }

    .slots-machine {
      background: rgba(255,255,255,0.1);
      padding: 25px;
      border-radius: 16px;
      margin: 20px 0;
      border: 2px solid rgba(255,255,255,0.2);
    }

    .slots-display {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 25px 0;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      border: 2px solid #6366f1;
    }

    .slot-reel {
      width: 70px;
      height: 70px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      border: 2px solid rgba(255,255,255,0.3);
      transition: all 0.3s ease;
    }

    .slot-reel.spinning {
      animation: spin-reel 0.1s linear infinite;
    }

    .slot-reel.winning {
      background: rgba(16, 185, 129, 0.3);
      border-color: #10b981;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    }

    @keyframes spin-reel {
      0% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
      100% { transform: translateY(0); }
    }

    .claim-section {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .claim-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .claim-info-item {
      text-align: center;
    }

    .claim-info-label {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 5px;
    }

    .share-button {
      background: linear-gradient(45deg, #6366f1, #8b5cf6);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 5px;
      width: auto;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
    }

    .share-section {
      text-align: center;
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Dog Fortune Wheel Styles - Fixed positioning and improved */
    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wheel-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    .dog-logo {
      font-size: 30px;
      animation: wag 2s ease-in-out infinite;
    }

    @keyframes wag {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .wheel-pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 25px;
      color: #ff6b6b;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      z-index: 11;
    }

    #wheelCanvas {
      display: block;
      margin: 0 auto;
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
      background: transparent;
    }

    .wheel-button {
      background: linear-gradient(135deg, #ff6b6b, #ff8e53);
      font-size: 20px;
      padding: 18px 36px;
      animation: pulse-glow 2s ease-in-out infinite;
      width: 100%;
      margin: 15px 0;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.3); }
      50% { box-shadow: 0 0 30px rgba(255, 107, 107, 0.6); }
    }

    .wheel-info {
      display: flex;
      justify-content: center;
      margin: 15px 0;
      padding: 10px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }

    .spin-cost {
      font-size: 16px;
      color: #f59e0b;
      font-weight: 600;
    }

    .recent-wins {
      margin-top: 30px;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }

    .win-item {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      margin: 5px 0;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      animation: slideIn 0.5s ease;
      font-size: 14px;
    }

    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .prize-legend {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }

    .prize-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .prize-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      font-size: 14px;
    }

    .prize-emoji {
      font-size: 24px;
    }

    .prize-xp {
      font-weight: 600;
      color: #f59e0b;
    }

    /* Achievement Modal */
    .achievement-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .achievement-content {
      background: linear-gradient(135deg, #1e003e 0%, #330066 100%);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      max-width: 350px;
      border: 2px solid #6366f1;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }

    .achievement-icon {
      font-size: 60px;
      margin-bottom: 15px;
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      width: auto;
      padding: 5px;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    
    .close-modal:hover {
      opacity: 1;
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }
      
      .xp-claim-section {
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .xp {
        font-size: 14px;
        padding: 8px 16px;
      }
      
      .claim-header-button {
        font-size: 13px;
        padding: 10px 16px;
        min-width: 120px;
      }
      
      .tabs-container {
        padding: 6px;
      }
      
      .tabs-row {
        margin-bottom: 6px;
      }
      
      .tab {
        font-size: 12px;
        padding: 10px 6px;
        margin: 0 2px;
      }
      
      .leaderboard-item {
        padding: 12px;
        margin: 8px 0;
      }
      
      .rank {
        font-size: 20px;
        width: 35px;
      }
      
      .player {
        font-size: 12px;
        margin: 0 10px;
      }
      
      .score {
        font-size: 12px;
      }
      
      .wheel-container {
        width: 280px;
        height: 280px;
      }
      
      #wheelCanvas {
        width: 280px !important;
        height: 280px !important;
      }
      
      .wheel-center {
        width: 60px;
        height: 60px;
      }
      
      .dog-logo {
        font-size: 30px;
      }
      
      .prize-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container app-content">
    <div class="header">
      <div class="title">🐕 Monad Dog</div>
      <div class="xp-claim-section">
        <div class="xp">✨ Available XP: <span id="xp">0</span></div>
        <button class="claim-header-button" id="claimHeaderButton" onclick="showTab('claim')">
          💰 Claim <span id="claimHeaderDOG">0</span> $DOG
        </button>
      </div>
    </div>

    <div class="wallet-section">
      <div id="connect-area">
        <button id="connect-btn">🟣 Connect Wallet</button>
      </div>
      <div id="connected-area" style="display: none;">
        <div>🟣 Connected</div>
        <div id="address" class="address"></div>
        <button id="disconnect-btn">Disconnect</button>
      </div>
    </div>

    <div class="tabs-container">
      <div class="tabs-row">
        <button class="tab active" onclick="showTab('pet')">🐕 Pet</button>
        <button class="tab" onclick="showTab('greet')">👋 Greet</button>
        <button class="tab" onclick="showTab('flip')">🪙 Flip</button>
      </div>
      <div class="tabs-row">
        <button class="tab" onclick="showTab('slots')">🎰 Slots</button>
        <button class="tab" onclick="showTab('wheel')">🎯 Wheel</button>
      </div>
    </div>

    <div class="content">
      <!-- Pet Tab -->
      <div id="pet" class="tab-content active">
        <h3>Pet the Dog</h3>
        <img id="dog-img" class="dog-image" src="https://placedog.net/400/300?id=7" alt="Dog">
        <button onclick="petDog()">👋 Pet Dog (+10 XP)</button>
        <div id="pet-status" class="status"></div>
        
        <div class="share-section">
          <button class="share-button" onclick="sharePetAchievement()">
            🐕 Share Pet Achievement
          </button>
        </div>
      </div>

      <!-- Greet Tab -->
      <div id="greet" class="tab-content">
        <h3>Greet Community</h3>
        <p>Say GM or GN to the community!</p>
        <button onclick="sayGM()">☀️ Good Morning (+5 XP)</button>
        <button onclick="sayGN()">🌙 Good Night (+5 XP)</button>
        <div id="greet-status" class="status"></div>
        
        <div class="share-section">
          <button class="share-button" onclick="shareGreetAchievement()">
            👋 Share Community Spirit
          </button>
        </div>
      </div>

      <!-- Flip Tab -->
      <div id="flip" class="tab-content">
        <h3>Flip Coin</h3>
        <div class="coin" id="coin">🪙</div>
        <button onclick="flipCoin()">🎲 Flip Coin (+3 XP)</button>
        <div id="flip-result">Result will appear here</div>
        <div id="flip-status" class="status"></div>
        
        <div class="share-section">
          <button class="share-button" onclick="shareFlipAchievement()">
            🪙 Share Lucky Moment
          </button>
        </div>
      </div>

      <!-- Slots Tab -->
      <div id="slots" class="tab-content">
        <h3>🎰 Dog Slots</h3>
        <p style="margin-bottom: 20px;">Match 4 same dogs or bones to win 5000 XP!</p>
        
        <div class="slots-machine">
          <div class="slots-display">
            <div class="slot-reel" id="reel1">🐕</div>
            <div class="slot-reel" id="reel2">🦮</div>
            <div class="slot-reel" id="reel3">🐶</div>
            <div class="slot-reel" id="reel4">🦴</div>
          </div>
          
          <button class="slots-button" id="slotsButton" onclick="playSlots()">
            🔒 Connect Wallet
          </button>
          
          <div id="slots-status" class="status"></div>
        </div>
        
        <div class="share-section">
          <button class="share-button" onclick="shareSlotsAchievement()">
            🎰 Share Slots Win
          </button>
        </div>
      </div>

      <!-- Dog Fortune Wheel Tab -->
      <div id="wheel" class="tab-content">
        <h3>🎯 Dog Fortune Wheel</h3>
        <p style="margin-bottom: 20px;">Spin the wheel and win tasty rewards!</p>
        
        <div class="wheel-container">
          <!-- Çarkın merkezi - Köpek logosu -->
          <div class="wheel-center">
            <div class="dog-logo">🐕</div>
          </div>
          
          <!-- Dönen çark -->
          <canvas id="wheelCanvas" width="350" height="350"></canvas>
          
          <!-- Ok işareti -->
          <div class="wheel-pointer">▼</div>
        </div>
        
        <div class="wheel-info">
          <div class="spin-cost">
            <span>🎫 1 Spin = 0.05 MONAD</span>
          </div>
        </div>
        
        <button class="wheel-button" id="spinButton" onclick="spinWheel()">
          🎯 Spin the Wheel
        </button>
        
        <div id="wheel-status" class="status"></div>
        
        <!-- Prize Legend -->
        <div class="prize-legend">
          <h4 style="margin-bottom: 10px;">🏆 Prize Pool</h4>
          <div class="prize-grid">
            <div class="prize-item">
              <span class="prize-emoji">🦴 Golden Bone</span>
              <span class="prize-xp">10000 XP</span>
            </div>
            <div class="prize-item">
              <span class="prize-emoji">🥩 Juicy Steak</span>
              <span class="prize-xp">2000 XP</span>
            </div>
            <div class="prize-item">
              <span class="prize-emoji">🍖 Big Meat</span>
              <span class="prize-xp">500 XP</span>
            </div>
            <div class="prize-item">
              <span class="prize-emoji">🦴 Lucky Bone</span>
              <span class="prize-xp">100 XP</span>
            </div>
            <div class="prize-item">
              <span class="prize-emoji">🍪 Dog Treat</span>
              <span class="prize-xp">50 XP</span>
            </div>
            <div class="prize-item">
              <span class="prize-emoji">💤 Nap Time</span>
              <span class="prize-xp">10 XP</span>
            </div>
          </div>
        </div>
        
        <!-- Recent Big Wins -->
        <div class="recent-wins">
          <h4>🏆 Recent Big Wins</h4>
          <div id="recentWinsList"></div>
        </div>
        
        <div class="share-section">
          <button class="share-button" onclick="shareWheelAchievement()">
            🎯 Share Fortune Win
          </button>
        </div>
      </div>

      <!-- Claim Tab -->
      <div id="claim" class="tab-content">
        <h3>Claim $DOG Tokens</h3>
        <p style="margin-bottom: 20px;">Convert your earned XP to $DOG tokens!</p>
        
        <div class="claim-section">
          <div class="claim-info">
            <div class="claim-info-item">
              <div class="claim-info-label">Available XP</div>
              <div class="claim-info-value" id="claimableXP">0</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label">→</div>
              <div style="font-size: 30px;">🔄</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label">$DOG Tokens</div>
              <div class="claim-info-value" id="claimableDOG">0</div>
            </div>
          </div>
          
          <button class="claim-button" id="claimButton" onclick="claimTokens()" disabled>
            💰 Claim $DOG Tokens
          </button>
          
          <div class="conversion-rate">
            Conversion Rate: 10 XP = 1 $DOG Token
          </div>
          
          <div id="claim-status" class="status"></div>
        </div>
        
        <!-- Wallet DOG Balance Display -->
        <div style="background: linear-gradient(135deg, #f59e0b, #eab308); padding: 20px; border-radius: 12px; text-align: center; margin: 15px 0;">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">Your Wallet Balance</div>
          <div style="font-size: 32px; font-weight: 700;">
            <span id="walletDogDisplay">0</span> $DOG
          </div>
          <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">🪙 Monad Testnet</div>
        </div>
      </div>
    </div>

    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading Monad Dog...</div>
    </div>

    <!-- Achievement Modal -->
    <div id="achievementModal" class="achievement-modal" onclick="if(event.target === this) closeAchievementModal()">
      <div class="achievement-content">
        <button class="close-modal" onclick="closeAchievementModal()">×</button>
        <div id="achievementIcon" class="achievement-icon">🎉</div>
        <h3 id="achievementTitle">Achievement Unlocked!</h3>
        <p id="achievementDescription">You did something awesome!</p>
        <div style="margin-top: 20px;">
          <button class="share-button" onclick="shareCurrentAchievement()">
            📢 Share on Farcaster
          </button>
          <button class="share-button" onclick="closeAchievementModal()" style="background: rgba(255,255,255,0.2);">
            ✨ Continue Playing
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let sdk = null;
    let activeTab = 'pet';
    let appState = {
      connected: false,
      address: null,
      xp: 0,
      slotsCredits: 0,
      provider: null,
      signer: null,
      isTransactionPending: false
    };

    // Contract configuration
    const CONTRACTS = {
      PET: "0xc53abe4c593b9440407f8ac1b346f3f999e6d8ed",
      GREET: "0xbc8b78f3e2348d4b5e0390fe700ce54b59931da4",
      FLIP: "0xc5b2280d1e2f155f9a2be2af7e78190658874106",
      SLOTS: "0xc7011f245aa51fa488783d5b0cfc6e0cba86f6cb",
      DOG_TOKEN: "0x1f6649d028c4c146c050a9b224115a01c92a02f3"
    };

    const ABIS = {
      PET: ["function pet() public"],
      GREET: ["function gm() public", "function gn() public"],
      FLIP: ["function flip() public"],
      SLOTS: [
        "function buyCredits() external payable",
        "function playSlots() external returns (uint8[4])",
        "function getCredits(address player) external view returns (uint256)"
      ],
      DOG_TOKEN: [
        "function claim(uint256 xpAmount) public",
        "function balanceOf(address account) public view returns (uint256)",
        "function decimals() public view returns (uint8)"
      ]
    };

    const XP_TO_DOG_RATE = 10;

    // Wheel game configuration
    const wheelSegments = [
      { emoji: '🦴', name: 'Golden Bone', chance: 1, xp: 10000, color: '#FFD700' },     // JACKPOT %1 - Altın
      { emoji: '🥩', name: 'Juicy Steak', chance: 5, xp: 2000, color: '#DC143C' },      // Mega Win %5 - Kırmızı
      { emoji: '🍖', name: 'Big Meat', chance: 10, xp: 500, color: '#FF6347' },         // Big Win %10 - Turuncu-Kırmızı
      { emoji: '🦴', name: 'Lucky Bone', chance: 20, xp: 100, color: '#32CD32' },       // Win %20 - Yeşil
      { emoji: '🍪', name: 'Dog Treat', chance: 30, xp: 50, color: '#4169E1' },         // Small Win %30 - Mavi
      { emoji: '💤', name: 'Nap Time', chance: 34, xp: 10, color: '#9370DB' }           // Try Again %34 - Mor
    ];

    // Wheel state
    let wheelState = {
      isSpinning: false,
      currentRotation: 0,
      segments: wheelSegments
    };

    // Supabase configuration
    const SUPABASE_URL = 'https://uhqszfoekqrjtybrwqzt.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocXN6Zm9la3FyanR5YnJ3cXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4MDMxNTAsImV4cCI6MjA2NjM3OTE1MH0.gGch8B6AlvGrZTDVjfd0xidVnh_Dsua4qRxbaixBqM0';
    
    let supabaseClient;

    // Initialize Supabase
    function initSupabase() {
      if (window.supabase) {
        const { createClient } = window.supabase;
        supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('✅ Supabase initialized');
      } else {
        console.error('❌ Supabase not loaded');
      }
    }

    // XP Management Functions
    async function getWalletXP(address) {
      if (!address) return 0;
      
      try {
        if (!supabaseClient) {
          const localXP = parseInt(localStorage.getItem(`wallet_xp_${address.toLowerCase()}`) || '0');
          return localXP;
        }

        const { data, error } = await supabaseClient
          .from('user_xp')
          .select('xp')
          .eq('wallet_address', address.toLowerCase())
          .maybeSingle();

        if (error && error.code !== 'PGRST116') {
          console.error('❌ Supabase fetch error:', error);
          const localXP = parseInt(localStorage.getItem(`wallet_xp_${address.toLowerCase()}`) || '0');
          return localXP;
        }
        
        if (!data) {
          return 0;
        }
        
        localStorage.setItem(`wallet_xp_${address.toLowerCase()}`, data.xp.toString());
        return data.xp || 0;
      } catch (e) {
        console.error('❌ Error fetching XP:', e);
        const localXP = parseInt(localStorage.getItem(`wallet_xp_${address.toLowerCase()}`) || '0');
        return localXP;
      }
    }

    async function saveWalletXP(address, xp) {
      if (!address) return;
      
      localStorage.setItem(`wallet_xp_${address.toLowerCase()}`, xp.toString());
      console.log(`💾 XP saved to localStorage: ${xp}`);
      
      if (!supabaseClient) return;
      
      try {
        const { data, error } = await supabaseClient
          .from('user_xp')
          .upsert(
            {
              wallet_address: address.toLowerCase(),
              xp: xp,
              updated_at: new Date().toISOString()
            },
            {
              onConflict: 'wallet_address'
            }
          );
        
        if (error) {
          console.error('❌ Supabase save error:', error);
        } else {
          console.log(`✅ XP saved to Supabase successfully`);
        }
      } catch (e) {
        console.error('❌ Exception saving XP to Supabase:', e);
      }
    }

    // Utility Functions
    function showStatus(id, message, type) {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = message;
        el.className = `status visible ${type}`;
      }
    }

    function hideStatus(id) {
      const el = document.getElementById(id);
      if (el) {
        el.className = 'status';
      }
    }

    function showError(message) {
      const div = document.createElement('div');
      div.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(255,0,0,0.9);color:white;padding:10px 20px;border-radius:8px;z-index:1000;max-width:90%;word-wrap:break-word;';
      div.textContent = message;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 5000);
    }

    // Wallet Connection
    async function connectWallet() {
      try {
        console.log('Connecting wallet...');
        
        const connectBtn = document.getElementById('connect-btn');
        connectBtn.textContent = '🔄 Connecting...';
        connectBtn.disabled = true;
        
        let provider;
        
        if (window.ethereum) {
          provider = window.ethereum;
        } else {
          throw new Error('No wallet available');
        }

        const accounts = await provider.request({
          method: 'eth_requestAccounts'
        });

        if (!accounts || accounts.length === 0) {
          throw new Error('No accounts found');
        }

        console.log('✅ Connected:', accounts[0]);

        appState.provider = new ethers.providers.Web3Provider(provider);
        appState.signer = appState.provider.getSigner();
        appState.address = accounts[0];
        appState.connected = true;

        updateWalletUI();
        await updateXPDisplay();
        await updateTokenBalance();

      } catch (error) {
        console.error('Connection error:', error);
        showError(error.message);
        
        const connectBtn = document.getElementById('connect-btn');
        connectBtn.textContent = '🟣 Connect Wallet';
        connectBtn.disabled = false;
      }
    }

    function disconnect() {
      appState = {
        connected: false,
        address: null,
        xp: 0,
        slotsCredits: 0,
        provider: null,
        signer: null
      };
      updateWalletUI();
      updateXPDisplay();
      console.log('🔌 Wallet disconnected');
    }

    function updateWalletUI() {
      const connectArea = document.getElementById('connect-area');
      const connectedArea = document.getElementById('connected-area');
      const addressEl = document.getElementById('address');

      if (appState.connected) {
        connectArea.style.display = 'none';
        connectedArea.style.display = 'block';
        addressEl.textContent = appState.address.slice(0,6) + '...' + appState.address.slice(-4);
      } else {
        connectArea.style.display = 'block';
        connectedArea.style.display = 'none';
      }
    }

    // XP Display Update
    async function updateXPDisplay() {
      if (appState.connected && appState.address) {
        const walletXP = await getWalletXP(appState.address);
        document.getElementById('xp').textContent = walletXP;
        appState.xp = walletXP;
        
        // Update claim preview
        updateClaimPreview();
        
        if (activeTab === 'claim') {
          updateClaimUI();
        }
      } else {
        document.getElementById('xp').textContent = '0';
        appState.xp = 0;
        updateClaimPreview();
        updateClaimUI();
      }
    }

    // Update claim preview in the header button
    function updateClaimPreview() {
      const claimableXP = appState.xp || 0;
      const claimableDOG = Math.floor(claimableXP / XP_TO_DOG_RATE);
      
      const claimHeaderDOG = document.getElementById('claimHeaderDOG');
      const claimHeaderButton = document.getElementById('claimHeaderButton');
      
      if (claimHeaderDOG) {
        claimHeaderDOG.textContent = claimableDOG;
      }
      
      if (claimHeaderButton) {
        if (claimableXP >= XP_TO_DOG_RATE && appState.connected) {
          claimHeaderButton.classList.add('ready');
          claimHeaderButton.disabled = false;
        } else {
          claimHeaderButton.classList.remove('ready');
          if (!appState.connected) {
            claimHeaderButton.disabled = true;
            claimHeaderButton.innerHTML = '🔒 Connect Wallet';
          } else {
            claimHeaderButton.disabled = true;
            claimHeaderButton.innerHTML = `💰 Need ${XP_TO_DOG_RATE - claimableXP} more XP`;
          }
        }
        
        // Reset text when ready
        if (claimableXP >= XP_TO_DOG_RATE && appState.connected) {
          claimHeaderButton.innerHTML = `💰 Claim <span id="claimHeaderDOG">${claimableDOG}</span> $DOG`;
        }
      }
    }

    // Add XP Function
    async function addXP(amount) {
      if (!appState.connected || !appState.address) {
        console.log('❌ Cannot add XP: wallet not connected');
        return;
      }
      
      console.log(`➕ Adding ${amount} XP to ${appState.address}`);
      
      const previousXP = appState.xp || 0;
      appState.xp = previousXP + amount;
      
      document.getElementById('xp').textContent = appState.xp;
      
      try {
        await saveWalletXP(appState.address, appState.xp);
        console.log(`✨ XP successfully updated: ${previousXP} → ${appState.xp} (+${amount})`);
      } catch (error) {
        console.error('❌ Error saving XP:', error);
      }
      
      if (activeTab === 'claim') {
        updateClaimUI();
      }
      
      // Update claim preview
      updateClaimPreview();
      
      // Add celebration effect
      const xpElement = document.getElementById('xp');
      xpElement.style.transform = 'scale(1.2)';
      xpElement.style.color = '#00ff00';
      
      setTimeout(() => {
        xpElement.style.transform = 'scale(1)';
        xpElement.style.color = 'white';
      }, 500);
    }

    // Network Setup
    async function ensureMonadNetwork() {
      const MONAD_CHAIN_ID = '0x279F'; // 10143 in hex
      
      try {
        const provider = window.ethereum;
        if (!provider) {
          throw new Error('No wallet provider available');
        }

        const chainId = await provider.request({ method: 'eth_chainId' });
        console.log('Current chain ID:', chainId);

        if (chainId !== MONAD_CHAIN_ID) {
          console.log('Switching to Monad Testnet...');
          
          try {
            await provider.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: MONAD_CHAIN_ID }],
            });
          } catch (switchError) {
            if (switchError.code === 4902) {
              await provider.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: MONAD_CHAIN_ID,
                  chainName: 'Monad Testnet',
                  nativeCurrency: {
                    name: 'Monad',
                    symbol: 'MONAD',
                    decimals: 18
                  },
                  rpcUrls: ['https://testnet-rpc.monad.xyz'],
                  blockExplorerUrls: ['https://testnet.monadscan.com/']
                }]
              });
            }
          }

          appState.provider = new ethers.providers.Web3Provider(provider);
          appState.signer = appState.provider.getSigner();
        }
      } catch (error) {
        console.error('Network switch error:', error);
        throw new Error('Failed to switch to Monad Testnet');
      }
    }

    // Game Functions
    window.petDog = async function() {
      console.log('🐕 Pet Dog clicked!');
      
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      try {
        document.getElementById('dog-img').src = `https://placedog.net/400/300?id=${Math.floor(Math.random() * 50) + 1}`;
        
        showStatus('pet-status', '🔐 Please confirm transaction...', 'pending');
        
        await ensureMonadNetwork();
        
        const contract = new ethers.Contract(CONTRACTS.PET, ABIS.PET, appState.signer);
        const tx = await contract.pet({ gasLimit: 100000 });
        
        showStatus('pet-status', '✅ Transaction sent! Processing...', 'pending');
        
        setTimeout(async () => {
          showStatus('pet-status', '🐕 Dog petted successfully! +10 XP', 'success');
          await addXP(10);
          setTimeout(() => hideStatus('pet-status'), 3000);
        }, 3000);
        
      } catch (error) {
        console.error('❌ Pet error:', error);
        let errorMsg = 'Transaction failed';
        if (error.message.includes('user rejected')) {
          errorMsg = 'Transaction cancelled by user';
        }
        showStatus('pet-status', errorMsg, 'error');
        setTimeout(() => hideStatus('pet-status'), 5000);
      }
    };

    window.sayGM = async function() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      try {
        showStatus('greet-status', '🔐 Please confirm transaction...', 'pending');
        
        await ensureMonadNetwork();
        
        const contract = new ethers.Contract(CONTRACTS.GREET, ABIS.GREET, appState.signer);
        const tx = await contract.gm({ gasLimit: 100000 });
        
        setTimeout(async () => {
          showStatus('greet-status', '☀️ Good Morning sent! +5 XP', 'success');
          await addXP(5);
          setTimeout(() => hideStatus('greet-status'), 3000);
        }, 3000);
        
      } catch (error) {
        console.error('❌ GM error:', error);
        showStatus('greet-status', 'Transaction failed', 'error');
        setTimeout(() => hideStatus('greet-status'), 5000);
      }
    };

    window.sayGN = async function() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      try {
        showStatus('greet-status', '🔐 Please confirm transaction...', 'pending');
        
        await ensureMonadNetwork();
        
        const contract = new ethers.Contract(CONTRACTS.GREET, ABIS.GREET, appState.signer);
        const tx = await contract.gn({ gasLimit: 100000 });
        
        setTimeout(async () => {
          showStatus('greet-status', '🌙 Good Night sent! +5 XP', 'success');
          await addXP(5);
          setTimeout(() => hideStatus('greet-status'), 3000);
        }, 3000);
        
      } catch (error) {
        console.error('❌ GN error:', error);
        showStatus('greet-status', 'Transaction failed', 'error');
        setTimeout(() => hideStatus('greet-status'), 5000);
      }
    };

    window.flipCoin = async function() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      try {
        const coin = document.getElementById('coin');
        const result = document.getElementById('flip-result');
        
        result.textContent = 'Flipping...';
        let rotation = 0;
        const interval = setInterval(() => {
          rotation += 180;
          coin.style.transform = `rotateY(${rotation}deg)`;
        }, 100);
        
        showStatus('flip-status', '🔐 Please confirm transaction...', 'pending');
        
        await ensureMonadNetwork();
        
        const contract = new ethers.Contract(CONTRACTS.FLIP, ABIS.FLIP, appState.signer);
        const tx = await contract.flip({ gasLimit: 100000 });
        
        setTimeout(() => {
          clearInterval(interval);
          const finalResult = Math.random() < 0.5 ? 'Heads' : 'Tails';
          coin.style.transform = `rotateY(${finalResult === 'Heads' ? 0 : 180}deg)`;
          result.textContent = `Result: ${finalResult}!`;
          
          showStatus('flip-status', '🪙 Coin flipped! +3 XP', 'success');
          addXP(3);
          setTimeout(() => hideStatus('flip-status'), 3000);
        }, 3000);
        
      } catch (error) {
        console.error('❌ Flip error:', error);
        showStatus('flip-status', 'Transaction failed', 'error');
        setTimeout(() => hideStatus('flip-status'), 5000);
      }
    };

    // Slots Game
    window.playSlots = async function() {
      if (!appState.connected) {
        showError('Connect wallet first');
        return;
      }
      
      try {
        const slotsButton = document.getElementById('slotsButton');
        slotsButton.disabled = true;
        slotsButton.textContent = '🎰 Playing...';
        
        showStatus('slots-status', '🔐 Please confirm 0.1 MONAD payment...', 'pending');
        
        await ensureMonadNetwork();
        
        const contract = new ethers.Contract(CONTRACTS.SLOTS, ABIS.SLOTS, appState.signer);
        const tx = await contract.buyCredits({
          value: ethers.utils.parseEther("0.1"),
          gasLimit: 150000
        });
        
        // Start visual animation
        const symbols = ['🐕', '🦮', '🐶', '🦴'];
        const reels = ['reel1', 'reel2', 'reel3', 'reel4'];
        
        reels.forEach(reelId => {
          const reel = document.getElementById(reelId);
          reel.classList.add('spinning');
        });
        
        const spinInterval = setInterval(() => {
          reels.forEach(reelId => {
            const reel = document.getElementById(reelId);
            reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
          });
        }, 100);
        
        setTimeout(() => {
          clearInterval(spinInterval);
          
          // Generate final results
          const results = [];
          for (let i = 0; i < 4; i++) {
            results.push(symbols[Math.floor(Math.random() * symbols.length)]);
          }
          
          reels.forEach((reelId, index) => {
            const reel = document.getElementById(reelId);
            reel.classList.remove('spinning');
            reel.textContent = results[index];
          });
          
          checkSlotsWin(results);
          
          slotsButton.disabled = false;
          slotsButton.textContent = '🎰 Play Again (0.1 MONAD)';
          
        }, 4000);
        
      } catch (error) {
        console.error('❌ Slots error:', error);
        const slotsButton = document.getElementById('slotsButton');
        slotsButton.disabled = false;
        slotsButton.textContent = '🎰 Play Slots (0.1 MONAD)';
        
        showStatus('slots-status', 'Game failed', 'error');
        setTimeout(() => hideStatus('slots-status'), 5000);
      }
    };

    function checkSlotsWin(results) {
      console.log('🎰 Slots results:', results);
      
      const symbolCounts = {};
      results.forEach(symbol => {
        symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
      });
      
      const maxCount = Math.max(...Object.values(symbolCounts));
      
      if (maxCount === 4) {
        const winningSymbol = Object.keys(symbolCounts).find(symbol => symbolCounts[symbol] === 4);
        
        document.querySelectorAll('.slot-reel').forEach(reel => {
          if (reel.textContent === winningSymbol) {
            reel.classList.add('winning');
          }
        });
        
        addXP(5000);
        showStatus('slots-status', `🎉 JACKPOT! 4x ${winningSymbol} = +5000 XP!`, 'success');
        
      } else if (maxCount === 3) {
        const winningSymbol = Object.keys(symbolCounts).find(symbol => symbolCounts[symbol] === 3);
        
        document.querySelectorAll('.slot-reel').forEach(reel => {
          if (reel.textContent === winningSymbol) {
            reel.classList.add('winning');
          }
        });
        
        addXP(500);
        showStatus('slots-status', `🏆 3x ${winningSymbol} = +500 XP!`, 'success');
        
      } else if (maxCount === 2) {
        addXP(50);
        showStatus('slots-status', `✨ Pair found = +50 XP!`, 'success');
        
      } else {
        showStatus('slots-status', '😔 No match this time. Try again!', 'error');
      }
      
      setTimeout(() => {
        hideStatus('slots-status');
        document.querySelectorAll('.slot-reel').forEach(reel => {
          reel.classList.remove('winning');
        });
      }, 5000);
    }

    // Claim Functions
    function updateClaimUI() {
      const claimableXP = appState.xp || 0;
      const claimableDOG = Math.floor(claimableXP / XP_TO_DOG_RATE);
      
      document.getElementById('claimableXP').textContent = claimableXP;
      document.getElementById('claimableDOG').textContent = claimableDOG;
      
      const claimButton = document.getElementById('claimButton');
      if (claimableXP >= XP_TO_DOG_RATE && appState.connected) {
        claimButton.disabled = false;
        claimButton.textContent = `💰 Claim ${claimableDOG} $DOG Tokens`;
      } else {
        claimButton.disabled = true;
        if (!appState.connected) {
          claimButton.textContent = '🔒 Connect Wallet First';
        } else if (claimableXP < XP_TO_DOG_RATE) {
          claimButton.textContent = `📈 Need ${XP_TO_DOG_RATE - claimableXP} more XP`;
        }
      }
    }

    async function updateTokenBalance() {
      if (!appState.connected || !appState.provider || !appState.address) {
        document.getElementById('walletDogDisplay').textContent = '0';
        return;
      }
      
      try {
        const dogTokenContract = new ethers.Contract(
          CONTRACTS.DOG_TOKEN,
          ABIS.DOG_TOKEN,
          appState.provider
        );
        
        const balance = await dogTokenContract.balanceOf(appState.address);
        const formattedBalance = ethers.utils.formatUnits(balance, 18);
        const numBalance = parseFloat(formattedBalance);
        const displayBalance = numBalance >= 1 ? numBalance.toFixed(2) : 
                             numBalance > 0 ? numBalance.toFixed(6) : '0';
        
        document.getElementById('walletDogDisplay').textContent = displayBalance;
        console.log(`✅ DOG Balance: ${displayBalance}`);
        
      } catch (error) {
        console.error('❌ Error fetching token balance:', error);
        document.getElementById('walletDogDisplay').textContent = '0';
      }
    }

    window.claimTokens = async function() {
      if (!appState.connected || !appState.signer) {
        showError('Please connect your wallet first');
        return;
      }
      
      const availableXP = appState.xp;
      const claimableDOG = Math.floor(availableXP / XP_TO_DOG_RATE);
      
      if (availableXP < XP_TO_DOG_RATE) {
        showError(`Need at least ${XP_TO_DOG_RATE} XP to claim tokens`);
        return;
      }
      
      const claimButton = document.getElementById('claimButton');
      
      try {
        claimButton.disabled = true;
        claimButton.textContent = '💰 Claiming...';
        
        showStatus('claim-status', '🔐 Please confirm transaction in your wallet...', 'pending');
        
        await ensureMonadNetwork();
        
        const dogTokenContract = new ethers.Contract(
          CONTRACTS.DOG_TOKEN,
          ABIS.DOG_TOKEN,
          appState.signer
        );
        
        const xpToClaim = claimableDOG * XP_TO_DOG_RATE;
        
        const tx = await dogTokenContract.claim(xpToClaim, {
          gasLimit: 100000
        });
        
        // Reset XP immediately after user confirms
        appState.xp = 0;
        document.getElementById('xp').textContent = '0';
        await saveWalletXP(appState.address, 0);
        updateClaimUI();
        
        showStatus('claim-status', `📡 Transaction sent! XP reset to 0`, 'pending');
        
        setTimeout(async () => {
          try {
            await updateTokenBalance();
            showStatus('claim-status', `✅ Successfully claimed ${claimableDOG} $DOG tokens!`, 'success');
            setTimeout(() => hideStatus('claim-status'), 8000);
            
          } catch (e) {
            showStatus('claim-status', `✅ Claim transaction sent! Tokens will arrive soon.`, 'success');
            setTimeout(() => hideStatus('claim-status'), 8000);
          }
        }, 5000);
        
      } catch (error) {
        console.error('❌ Claim error:', error);
        
        let errorMsg = 'Failed to claim tokens';
        
        if (error.message.includes('user rejected')) {
          errorMsg = 'Transaction cancelled - XP not affected';
          // Don't reset XP if user cancelled
        } else if (error.message.includes('insufficient funds')) {
          errorMsg = 'Insufficient gas funds';
        }
        
        showStatus('claim-status', errorMsg, 'error');
        setTimeout(() => hideStatus('claim-status'), 5000);
        
        // Re-enable button
        updateClaimUI();
      }
    };

    // Tab Management
    window.showTab = function(tabName) {
      console.log('📑 Switching to tab:', tabName);
      activeTab = tabName;
      
      // Update all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Update claim header button
      const claimHeaderButton = document.getElementById('claimHeaderButton');
      if (tabName === 'claim') {
        claimHeaderButton.classList.add('active');
      } else {
        claimHeaderButton.classList.remove('active');
        // Find and activate the clicked tab
        const clickedTab = event.target.closest('.tab');
        if (clickedTab) {
          clickedTab.classList.add('active');
        }
      }
      
      // Update content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');
      
      if (tabName === 'claim') {
        updateClaimUI();
        setTimeout(() => {
          updateTokenBalance();
        }, 500);
      }
      
      if (tabName === 'slots') {
        updateSlotsButton();
      }
      
      if (tabName === 'wheel') {
        drawWheel();
        updateWheelButton();
      }
    };

    function updateSlotsButton() {
      const slotsButton = document.getElementById('slotsButton');
      if (!slotsButton) return;
      
      if (appState.connected) {
        slotsButton.textContent = '🎰 Play Slots (0.1 MONAD)';
        slotsButton.disabled = false;
      } else {
        slotsButton.textContent = '🔒 Connect Wallet';
        slotsButton.disabled = true;
      }
    }

    function updateWheelButton() {
      const spinButton = document.getElementById('spinButton');
      if (!spinButton) return;
      
      if (appState.connected) {
        spinButton.textContent = '🎯 Spin the Wheel';
        spinButton.disabled = false;
      } else {
        spinButton.textContent = '🔒 Connect Wallet';
        spinButton.disabled = true;
      }
    }

    // Initialize App
    async function initApp() {
      try {
        showLoading();
        
        // Initialize Supabase
        initSupabase();
        
        // Setup event listeners
        document.getElementById('connect-btn').onclick = connectWallet;
        document.getElementById('disconnect-btn').onclick = disconnect;
        
        // Initialize wheel
        drawWheel();
        
        // Initialize claim preview
        updateClaimPreview();
        
        // Add resize listener for wheel
        window.addEventListener('resize', () => {
          if (activeTab === 'wheel') {
            drawWheel();
          }
        });
        
        hideLoading();
        console.log('✅ App initialized successfully');
        
      } catch (error) {
        console.error('❌ Init error:', error);
        hideLoading();
      }
    }

    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
      document.querySelector('.app-content').classList.remove('loaded');
    }

    function hideLoading() {
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        document.querySelector('.app-content').classList.add('loaded');
      }, 1000);
    }

    // Start app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }

    console.log('📱 App script loaded');
  </script>
</body>
</html>
